BOOST_DIR     = ../boost
IDAS_DIR      = ../idas

BOOST_INCLUDE = -I$(BOOST_DIR)
IDAS_INCLUDE  = -I$(IDAS_DIR)/build/include
BOOST_LIBS    = -L$(BOOST_DIR)/stage/lib -lboost_mpi -lboost_serialization -lboost_filesystem -lboost_system -lpthread
IDAS_LIBS     = -L$(IDAS_DIR)/build/lib -lsundials_idas -lsundials_nvecparallel -lblas -llapack
MPI_LIBS      = -lmpi_cxx -lmpi

CC            = mpicc
CXX           = mpicxx
DEFINES       =
CFLAGS        = -m64 -pipe -pthread -std=c99   -Wall -Wextra -Wno-unused-parameter -Wno-unused-variable -O2 $(DEFINES)
CXXFLAGS      = -m64 -pipe -pthread -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wno-unused-variable -O2 $(DEFINES)
INCPATH       = -I. $(BOOST_INCLUDE) $(IDAS_INCLUDE)
LINK          = mpicxx
LFLAGS        = -m64 -pthread -Wl,-O2
LIBS          = $(BOOST_LIBS) $(IDAS_LIBS) $(MPI_LIBS)
OBJECTS_DIR   = release
DESTDIR       = bin/
TARGET        = $(DESTDIR)/daetools_mpi_simulator
DEL_FILE      = rm -f

SOURCES       = auxiliary.cpp \
                daesolver.cpp \
                simulation.cpp \
                model.cpp \
                compute_stack_openmp.cpp \
                lasolver.cpp \
                main.cpp 

OBJECTS       = $(OBJECTS_DIR)/auxiliary.o \
                $(OBJECTS_DIR)/daesolver.o \
                $(OBJECTS_DIR)/simulation.o \
                $(OBJECTS_DIR)/model.o \
                $(OBJECTS_DIR)/compute_stack_openmp.o \
                $(OBJECTS_DIR)/lasolver.o \
                $(OBJECTS_DIR)/main.o

first: all

all: $(TARGET)

$(TARGET): $(OBJECTS)  
	$(LINK) $(LFLAGS) -o $(TARGET) $(OBJECTS) $(OBJCOMP) $(LIBS)

clean: 
	-$(DEL_FILE) $(OBJECTS) $(TARGET)

$(OBJECTS_DIR)/auxiliary.o: auxiliary.cpp auxiliary.h typedefs.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/auxiliary.o auxiliary.cpp

$(OBJECTS_DIR)/daesolver.o: daesolver.cpp auxiliary.h typedefs.h daesolver.h simulation.h model.h lasolver.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/daesolver.o daesolver.cpp

$(OBJECTS_DIR)/simulation.o: simulation.cpp auxiliary.h typedefs.h simulation.h model.h daesolver.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/simulation.o simulation.cpp

$(OBJECTS_DIR)/model.o: model.cpp model.h auxiliary.h typedefs.h runtime_information.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/model.o model.cpp

$(OBJECTS_DIR)/compute_stack_openmp.o: compute_stack_openmp.cpp compute_stack_openmp.h compute_stack.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/compute_stack_openmp.o compute_stack_openmp.cpp

$(OBJECTS_DIR)/lasolver.o: lasolver.cpp lasolver.h typedefs.h model.h auxiliary.h 
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/lasolver.o lasolver.cpp

$(OBJECTS_DIR)/main.o: main.cpp model.h auxiliary.h typedefs.h simulation.h daesolver.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(OBJECTS_DIR)/main.o main.cpp
