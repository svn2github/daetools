<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>tutorial_che_3.py</title>
</head>
<!-- Highlighting: "Python" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<span style='color:#017a31;'>#!/usr/bin/env python</span>
<span style='color:#017a31;'># -*- coding: utf-8 -*-</span>

<span style='color:#017a31;'>&quot;&quot;&quot;</span>
<span style='color:#017a31;'>***********************************************************************************</span>
<span style='color:#017a31;'>                           tutorial_che_3.py</span>
<span style='color:#017a31;'>                DAE Tools: pyDAE module, www.daetools.com</span>
<span style='color:#017a31;'>                Copyright (C) Dragan Nikolic</span>
<span style='color:#017a31;'>***********************************************************************************</span>
<span style='color:#017a31;'>DAE Tools is free software; you can redistribute it and/or modify it under the</span>
<span style='color:#017a31;'>terms of the GNU General Public License version 3 as published by the Free Software</span>
<span style='color:#017a31;'>Foundation. DAE Tools is distributed in the hope that it will be useful, but WITHOUT</span>
<span style='color:#017a31;'>ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<span style='color:#017a31;'>PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>
<span style='color:#017a31;'>You should have received a copy of the GNU General Public License along with the</span>
<span style='color:#017a31;'>DAE Tools software; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span style='color:#017a31;'>************************************************************************************</span>
<span style='color:#017a31;'>&quot;&quot;&quot;</span>
__doc__ <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc0000;'>&quot;&quot;&quot;</span>
<span style='color:#cc0000;'>Batch reactor seeded crystallisation using the method of moments.</span>

<span style='color:#cc0000;'>References (model equations and input parameters):</span>

<span style='color:#cc0000;'>- Nikolic D.D., Frawley P.J. (2016) Application of the Lagrangian Meshfree Approach</span>
<span style='color:#cc0000;'>  to Modelling of Batch Crystallisation: Part I - Modelling of Stirred Tank Hydrodynamics.</span>
<span style='color:#cc0000;'>  Chemical Engineering Science 145:317-328.</span>
<span style='color:#cc0000;'>  `doi:10.1016/j.ces.2015.08.052 &lt;http://dx.doi.org/10.1016/j.ces.2015.08.052&gt;`_</span>
<span style='color:#cc0000;'>- Mitchell N.A., O'Ciardha C.T., Frawley P.J. (2011) Estimation of the growth kinetics</span>
<span style='color:#cc0000;'>  for the cooling crystallisation of paracetamol and ethanol solutions.</span>
<span style='color:#cc0000;'>  Journal of Crystal Growth 328:39-49.</span>
<span style='color:#cc0000;'>  `doi:10.1016/j.jcrysgro.2011.06.016 &lt;http://dx.doi.org/10.1016/j.jcrysgro.2011.06.016&gt;`_</span>

<span style='color:#cc0000;'>The main assumptions:</span>

<span style='color:#cc0000;'>- Seeded crystallisation</span>
<span style='color:#cc0000;'>- Ideal mixing</span>
<span style='color:#cc0000;'>- Fixed cooling rate</span>
<span style='color:#cc0000;'>- Size independent growth</span>

<span style='color:#cc0000;'>Solubility of Paracetamol in ethanol:</span>

<span style='color:#cc0000;'>.. code-block:: none</span>

<span style='color:#cc0000;'>   ---------------------------------------------------------</span>
<span style='color:#cc0000;'>   Temperature       Solubility          Solubility </span>
<span style='color:#cc0000;'>        C        kg Parac./kg EtOH   mol Parac./m3 EtOH</span>
<span style='color:#cc0000;'>   ---------------------------------------------------------</span>
<span style='color:#cc0000;'>         0           0.11362                593.0387</span>
<span style='color:#cc0000;'>        10           0.14128                737.4215</span>
<span style='color:#cc0000;'>        20           0.17568                916.9562</span>
<span style='color:#cc0000;'>        30           0.21845                1140.2008</span>
<span style='color:#cc0000;'>        40           0.27163                1417.7972</span>
<span style='color:#cc0000;'>        50           0.33777                1762.9779</span>
<span style='color:#cc0000;'>        60           0.42000                2192.1973</span>
<span style='color:#cc0000;'>   ---------------------------------------------------------</span>

<span style='color:#cc0000;'>The supersaturation plot:</span>

<span style='color:#cc0000;'>.. image:: _static/tutorial_che_3-results.png</span>
<span style='color:#cc0000;'>   :width: 500px</span>

<span style='color:#cc0000;'>The concentration plot:</span>

<span style='color:#cc0000;'>.. image:: _static/tutorial_che_3-results2.png</span>
<span style='color:#cc0000;'>   :width: 500px</span>

<span style='color:#cc0000;'>The recovery plot:</span>

<span style='color:#cc0000;'>.. image:: _static/tutorial_che_3-results3.png</span>
<span style='color:#cc0000;'>   :width: 500px</span>

<span style='color:#cc0000;'>The yield plot:</span>

<span style='color:#cc0000;'>.. image:: _static/tutorial_che_3-results4.png</span>
<span style='color:#cc0000;'>   :width: 500px</span>

<span style='color:#cc0000;'>The total number of crystals plot:</span>

<span style='color:#cc0000;'>.. image:: _static/tutorial_che_3-results5.png</span>
<span style='color:#cc0000;'>   :width: 500px</span>
<span style='color:#cc0000;'>&quot;&quot;&quot;</span>

<span style='color:#3605fb;'>import</span> sys, numpy
<span style='color:#3605fb;'>from</span> daetools.pyDAE <span style='color:#3605fb;'>import</span> <b><span style='color:#0000ff;'>*</span></b>
<span style='color:#3605fb;'>from</span> time <span style='color:#3605fb;'>import</span> localtime, strftime

<span style='color:#017a31;'># Standard variable types are defined in variable_types.py</span>
<span style='color:#3605fb;'>from</span> pyUnits <span style='color:#3605fb;'>import</span> m, g, kg, s, K, mol, kmol, J, um

pbm_growth_rate_t                <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_growth_rate_t&quot;</span>,                m<b><span style='color:#0000ff;'>/</span></b>s,                    <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.1</span>, <span style='color:#cc047c;'>1e-05</span>)
pbm_birth_rate_t                 <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_birth_rate_t&quot;</span>,                 (s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>1</span>)) <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>3</span>)),  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-05</span>)
pbm_death_rate_t                 <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_death_rate_t&quot;</span>,                 (s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>1</span>)) <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>3</span>)),  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-05</span>)
pbm_solution_concentration_t     <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_solution_concentration_t&quot;</span>,     kg<b><span style='color:#0000ff;'>/</span></b>kg,                  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.1</span>, <span style='color:#cc047c;'>1e-05</span>)
pbm_solution_concentration_vol_t <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_solution_concentration_vol_t&quot;</span>, kmol<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),            <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.1</span>, <span style='color:#cc047c;'>1e-05</span>)

pbm_number_t  <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_number_t&quot;</span>,  m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>3</span>),           <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-05</span>)
pbm_length_t  <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_length_t&quot;</span>,  m<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),          <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-06</span>)
pbm_area_t    <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_area_t&quot;</span>,    (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>2</span>)<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),     <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-08</span>)
pbm_volume_t  <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_volume_t&quot;</span>,  (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),     <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-10</span>)
pbm_moment4_t <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_moment4_t&quot;</span>, (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>4</span>)<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),     <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-11</span>)
pbm_moment5_t <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_moment5_t&quot;</span>, (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>5</span>)<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>),     <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-12</span>)

pbm_diameter_t <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#cc0000;'>&quot;pbm_diameter_t&quot;</span>,  m, <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1.0e+20</span>,  <span style='color:#cc047c;'>0.0</span>, <span style='color:#cc047c;'>1e-10</span>)

<b>class</b> modTutorial(daeModel):
    <b>def</b> <b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#3605fb;'>self</span>, Name, Parent <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>None</span>, Description <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc0000;'>&quot;&quot;</span>):
        daeModel.<b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#3605fb;'>self</span>, Name, Parent, Description)

        <span style='color:#3605fb;'>self</span>.n <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>2.276</span> <span style='color:#017a31;'># Nucleation rate exponent</span>
        <span style='color:#3605fb;'>self</span>.g <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1.602</span> <span style='color:#017a31;'># Growth rate exponent</span>
        kg_units <b><span style='color:#0000ff;'>=</span></b> (m<b><span style='color:#0000ff;'>/</span></b>s)<b><span style='color:#0000ff;'>*</span></b>(((m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)<b><span style='color:#0000ff;'>/</span></b>kmol)<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>1.602</span>)
        kn_units <b><span style='color:#0000ff;'>=</span></b> (s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>1</span>))<b><span style='color:#0000ff;'>*</span></b>(m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>3</span>)) <b><span style='color:#0000ff;'>*</span></b> ((kg<b><span style='color:#0000ff;'>/</span></b>kg)<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>2.276</span>)

        <span style='color:#3605fb;'>self</span>.Nm <b><span style='color:#0000ff;'>=</span></b> daeDomain(<span style='color:#cc0000;'>&quot;Nm&quot;</span>, <span style='color:#3605fb;'>self</span>, m, <span style='color:#cc0000;'>&quot;Number of moments&quot;</span>)
        
        <span style='color:#3605fb;'>self</span>.R      <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;R&quot;</span>,     J<b><span style='color:#0000ff;'>/</span></b>(mol<b><span style='color:#0000ff;'>*</span></b>K), <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Universal gas constant&quot;</span>)
        <span style='color:#3605fb;'>self</span>.MW     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;MW&quot;</span>,    kg<b><span style='color:#0000ff;'>/</span></b>kmol,   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Molecular weight of paracetamol&quot;</span>)
        <span style='color:#3605fb;'>self</span>.V      <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;V&quot;</span>,     m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>,      <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Volume of the suspension in the reactor&quot;</span>)
        <span style='color:#3605fb;'>self</span>.kg     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;kg&quot;</span>,    kg_units,  <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Growth rate constant&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Ea     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;Ea&quot;</span>,    J<b><span style='color:#0000ff;'>/</span></b>mol,     <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Activation energy&quot;</span>)
        <span style='color:#3605fb;'>self</span>.kn     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;kn&quot;</span>,    kn_units,  <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Nucleation rate constant&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Kv     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;Kv&quot;</span>,    unit(),    <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Volume shape factor&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Ka     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;Ka&quot;</span>,    unit(),    <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Surface area shape factor&quot;</span>)
        <span style='color:#3605fb;'>self</span>.rho_s  <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;rho_s&quot;</span>, kg<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>), <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Density of solution&quot;</span>)
        <span style='color:#3605fb;'>self</span>.cp_s   <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;cp_s&quot;</span>,  J<b><span style='color:#0000ff;'>/</span></b>(kg<b><span style='color:#0000ff;'>*</span></b>K),  <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Specific heat capacity of solution&quot;</span>)
        <span style='color:#3605fb;'>self</span>.rho_c  <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;rho_c&quot;</span>, kg<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>), <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Density of crystals&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Qr     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;Qr&quot;</span>,    W,         <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Cooling rate&quot;</span>)
        <span style='color:#3605fb;'>self</span>.L0     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#cc0000;'>&quot;L_0&quot;</span>,   m,         <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Initial size of the nucleus&quot;</span>)

        <span style='color:#3605fb;'>self</span>.m0     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_0&quot;</span>,    pbm_number_t,                       <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 0&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m1     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_1&quot;</span>,    pbm_length_t,                       <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 1&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m2     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_2&quot;</span>,    pbm_area_t,                         <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 2&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m3     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_3&quot;</span>,    pbm_volume_t,                       <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 3&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m4     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_4&quot;</span>,    pbm_moment4_t,                      <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 4&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m5     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_5&quot;</span>,    pbm_moment5_t,                      <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Distribution moment 5&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m_norm <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;m_norm&quot;</span>, no_t,                               <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Normalized distribution moments&quot;</span>, [<span style='color:#3605fb;'>self</span>.Nm])
        <span style='color:#3605fb;'>self</span>.T      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;T&quot;</span>,      temperature_t,                      <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Solution temperature&quot;</span>)
        <span style='color:#3605fb;'>self</span>.G      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;G&quot;</span>,      pbm_growth_rate_t,                  <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Growth rate&quot;</span>)
        <span style='color:#3605fb;'>self</span>.B      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;B&quot;</span>,      pbm_birth_rate_t,                   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Birth rate&quot;</span>)
        <span style='color:#3605fb;'>self</span>.c      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;c&quot;</span>,      pbm_solution_concentration_t,       <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Solution concentration&quot;</span>)
        <span style='color:#3605fb;'>self</span>.c_star <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;c_star&quot;</span>, pbm_solution_concentration_t,       <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Solution equlibrium concentration (solubility)&quot;</span>)
        <span style='color:#3605fb;'>self</span>.delta_c<b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;delta_c&quot;</span>,pbm_solution_concentration_vol_t,   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Concentrations driving force&quot;</span>)
        <span style='color:#3605fb;'>self</span>.S      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;S&quot;</span>,      no_t,                               <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Supersaturation&quot;</span>)
        
        <span style='color:#3605fb;'>self</span>.Yield      <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Yield&quot;</span>,      mass_t,         <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Crystals yield&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Yield_max  <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Yield_max&quot;</span>,  mass_t,         <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Maximal crystals yield&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Recovery   <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Recovery&quot;</span>,   no_t,           <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Product recovery&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Ntotal     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Ntotal&quot;</span>,     pbm_number_t,   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Total number of crystals&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Ltotal     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Ltotal&quot;</span>,     pbm_length_t,   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Total length of crystals&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Atotal     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Atotal&quot;</span>,     pbm_area_t,     <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Total surface area of crystals&quot;</span>)
        <span style='color:#3605fb;'>self</span>.Vtotal     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;Vtotal&quot;</span>,     pbm_volume_t,   <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Total volume of crystals&quot;</span>)
        <span style='color:#3605fb;'>self</span>.D10        <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;D10&quot;</span>,        pbm_diameter_t, <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Mean size of crystals 1&quot;</span>)
        <span style='color:#3605fb;'>self</span>.D43        <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#cc0000;'>&quot;D43&quot;</span>,        pbm_diameter_t, <span style='color:#3605fb;'>self</span>, <span style='color:#cc0000;'>&quot;Mean size of crystals 2&quot;</span>)

    <b>def</b> DeclareEquations(<span style='color:#3605fb;'>self</span>):
        daeModel.DeclareEquations(<span style='color:#3605fb;'>self</span>)

        <span style='color:#017a31;'># Heat balance</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;T&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.rho_s() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.V() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.cp_s() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.T.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.Qr() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.T() <b><span style='color:#0000ff;'>-</span></b> Constant(<span style='color:#cc047c;'>273.14</span> <b><span style='color:#0000ff;'>*</span></b> K))<b><span style='color:#0000ff;'>/</span></b>Constant(<span style='color:#cc047c;'>1</span> <b><span style='color:#0000ff;'>*</span></b> K)

        <span style='color:#017a31;'># Solution concentration</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;c&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.c.dt() <b><span style='color:#0000ff;'>+</span></b> <span style='color:#cc047c;'>3</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.rho_c() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.Kv() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m2() <b><span style='color:#0000ff;'>/</span></b> <span style='color:#3605fb;'>self</span>.rho_s()

        <span style='color:#017a31;'># Solubility (in kg/kg, as given in the paper)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;c_star&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.c_star() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>2.955e-4</span> <b><span style='color:#0000ff;'>*</span></b> Exp(Constant(<span style='color:#cc047c;'>2.179e-2</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#cc047c;'>1</span><b><span style='color:#0000ff;'>/</span></b>K) <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.T())

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;S&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.S() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.c() <b><span style='color:#0000ff;'>/</span></b> (<span style='color:#3605fb;'>self</span>.c_star() <b><span style='color:#0000ff;'>+</span></b> Constant(<span style='color:#cc047c;'>1e-20</span> <b><span style='color:#0000ff;'>*</span></b> kg<b><span style='color:#0000ff;'>/</span></b>kg))

        <span style='color:#017a31;'># Nucleation kinetics</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;B&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.kn() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.delta_c()<b><span style='color:#0000ff;'>**</span></b><span style='color:#3605fb;'>self</span>.n)
        eq.CheckUnitsConsistency <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>False</span>

        <span style='color:#017a31;'># Nucleation kinetics</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;delta_c&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.delta_c() <b><span style='color:#0000ff;'>-</span></b> (<span style='color:#3605fb;'>self</span>.c() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.c_star()) <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.rho_s() <b><span style='color:#0000ff;'>/</span></b> <span style='color:#3605fb;'>self</span>.MW()
        
        <span style='color:#017a31;'># Growth kinetics</span>
        <span style='color:#017a31;'># A safe-guard: prevent the negative concentration by setting the growth rate to zero</span>
        <span style='color:#017a31;'># if the supersaturation drops below one (that is no driving force)</span>
        <span style='color:#3605fb;'>self</span>.IF(<span style='color:#3605fb;'>self</span>.S() <b><span style='color:#0000ff;'>&gt;</span></b> <span style='color:#cc047c;'>1</span>)
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;G&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.kg() <b><span style='color:#0000ff;'>*</span></b> Exp(<b><span style='color:#0000ff;'>-</span></b><span style='color:#3605fb;'>self</span>.Ea() <b><span style='color:#0000ff;'>/</span></b> (<span style='color:#3605fb;'>self</span>.R() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.T())) <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.delta_c()<b><span style='color:#0000ff;'>**</span></b><span style='color:#3605fb;'>self</span>.g)
        eq.CheckUnitsConsistency <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>False</span>

        <span style='color:#3605fb;'>self</span>.ELSE()
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;G&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.G()
        <span style='color:#3605fb;'>self</span>.END_IF()
        
        <span style='color:#017a31;'># Moments</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(0)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m0.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(1)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m1.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>1</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m0() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.L0()<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>1</span>)

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(2)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m2.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>2</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m1() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.L0()<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>2</span>)
        eq.Scaling <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1e5</span>

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(3)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m3.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>3</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m2() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.L0()<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)
        eq.Scaling <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1e8</span>

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(4)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m4.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>4</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m3() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.L0()<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>4</span>)
        eq.Scaling <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1e10</span>

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Moment(5)&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m5.dt() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#cc047c;'>5</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.G() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m4() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.B() <b><span style='color:#0000ff;'>*</span></b> (<span style='color:#3605fb;'>self</span>.L0()<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>5</span>)
        eq.Scaling <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1e12</span>

        <span style='color:#017a31;'># Normalized moments 0-5</span>
        moments <b><span style='color:#0000ff;'>=</span></b> [<span style='color:#3605fb;'>self</span>.m0(), <span style='color:#3605fb;'>self</span>.m1(), <span style='color:#3605fb;'>self</span>.m2(), <span style='color:#3605fb;'>self</span>.m3(), <span style='color:#3605fb;'>self</span>.m4(), <span style='color:#3605fb;'>self</span>.m5()]
        <b>for</b> k <b>in</b> <span style='color:#2a00d6;'>range</span>(<span style='color:#cc047c;'>0</span>, <span style='color:#3605fb;'>self</span>.Nm.NumberOfPoints):
            eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;NormalizedMoment(</span><span style='color:#cc0000;'>%d</span><span style='color:#cc0000;'>)&quot;</span> <b><span style='color:#0000ff;'>%</span></b> k, <span style='color:#cc0000;'>&quot;&quot;</span>)
            eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.m_norm(k) <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m0() <b><span style='color:#0000ff;'>-</span></b> moments[k]
            eq.CheckUnitsConsistency <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>False</span>

        <span style='color:#017a31;'># Performance indicators</span>
        <span style='color:#017a31;'># Crystals concentration (crystals yield)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Yield&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Yield() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.rho_c() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.Kv() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m3() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.V()
            
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Yield_max&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Yield_max() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.rho_c() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.Kv() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m3() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.V() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.c()<b><span style='color:#0000ff;'>*</span></b><span style='color:#3605fb;'>self</span>.rho_s()<b><span style='color:#0000ff;'>*</span></b><span style='color:#3605fb;'>self</span>.V()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Recovery&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Recovery() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.Yield() <b><span style='color:#0000ff;'>/</span></b> (<span style='color:#3605fb;'>self</span>.Yield_max() <b><span style='color:#0000ff;'>+</span></b> Constant(<span style='color:#cc047c;'>1E-20</span><b><span style='color:#0000ff;'>*</span></b>kg))

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Ntotal&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Ntotal() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.m0()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Ltotal&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Ltotal() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.m1()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Atotal&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Atotal() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.Ka() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m2()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;Vtotal&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.Vtotal() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.Kv() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m3()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;D10&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.D10() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m0() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.m1()

        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.CreateEquation(<span style='color:#cc0000;'>&quot;D43&quot;</span>, <span style='color:#cc0000;'>&quot;&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>self</span>.D43() <b><span style='color:#0000ff;'>*</span></b> <span style='color:#3605fb;'>self</span>.m3() <b><span style='color:#0000ff;'>-</span></b> <span style='color:#3605fb;'>self</span>.m4()

<b>class</b> simTutorial(daeSimulation):
    <b>def</b> <b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#3605fb;'>self</span>):
        daeSimulation.<b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#3605fb;'>self</span>)
        <span style='color:#3605fb;'>self</span>.m <b><span style='color:#0000ff;'>=</span></b> modTutorial(<span style='color:#cc0000;'>&quot;tutorial_che_3&quot;</span>)
        <span style='color:#3605fb;'>self</span>.m.Description <b><span style='color:#0000ff;'>=</span></b> __doc__

    <b>def</b> SetUpParametersAndDomains(<span style='color:#3605fb;'>self</span>):
        <span style='color:#3605fb;'>self</span>.m.Nm.CreateArray(<span style='color:#cc047c;'>6</span>)

        <span style='color:#3605fb;'>self</span>.m.V.SetValue(<span style='color:#cc047c;'>0.5e-3</span> <b><span style='color:#0000ff;'>*</span></b> m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)
        
        <span style='color:#3605fb;'>self</span>.m.R.SetValue(<span style='color:#cc047c;'>8.3144</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>(mol<b><span style='color:#0000ff;'>*</span></b>K))
        <span style='color:#3605fb;'>self</span>.m.MW.SetValue(<span style='color:#cc047c;'>151.163</span> <b><span style='color:#0000ff;'>*</span></b> g<b><span style='color:#0000ff;'>/</span></b>mol)
        
        <span style='color:#3605fb;'>self</span>.m.kg.SetValue(<span style='color:#cc047c;'>9.979</span>)
        <span style='color:#3605fb;'>self</span>.m.Ea.SetValue(<span style='color:#cc047c;'>40560</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>mol)

        <span style='color:#3605fb;'>self</span>.m.kn.SetValue(<span style='color:#cc047c;'>1.597E10</span><b><span style='color:#0000ff;'>/</span></b><span style='color:#cc047c;'>60.0</span> <b><span style='color:#0000ff;'>*</span></b> ((s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>1</span>))<b><span style='color:#0000ff;'>*</span></b>(m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#cc047c;'>3</span>))))

        <span style='color:#3605fb;'>self</span>.m.Ka.SetValue(<span style='color:#cc047c;'>5.196</span>)               <span style='color:#017a31;'># Surface area shape factor</span>
        <span style='color:#3605fb;'>self</span>.m.Kv.SetValue(<span style='color:#cc047c;'>0.866</span>)               <span style='color:#017a31;'># Volume shape factor</span>
        <span style='color:#3605fb;'>self</span>.m.rho_c.SetValue(<span style='color:#cc047c;'>1332</span> <b><span style='color:#0000ff;'>*</span></b> kg<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)) <span style='color:#017a31;'># Paracetamol</span>
        <span style='color:#3605fb;'>self</span>.m.rho_s.SetValue(<span style='color:#cc047c;'>789</span> <b><span style='color:#0000ff;'>*</span></b> kg<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>))  <span style='color:#017a31;'># Ethanol</span>
        <span style='color:#3605fb;'>self</span>.m.cp_s.SetValue(<span style='color:#cc047c;'>112.4</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>(kg<b><span style='color:#0000ff;'>*</span></b>K))  <span style='color:#017a31;'># cp of Ethanol</span>
        <span style='color:#3605fb;'>self</span>.m.Qr.SetValue(<span style='color:#cc047c;'>0.0</span> <b><span style='color:#0000ff;'>*</span></b> W)             <span style='color:#017a31;'># Cooling rate in Watts</span>
        <span style='color:#3605fb;'>self</span>.m.L0.SetValue(<span style='color:#cc047c;'>1e-6</span> <b><span style='color:#0000ff;'>*</span></b> m)            <span style='color:#017a31;'># 1um</span>

    <b>def</b> SetUpVariables(<span style='color:#3605fb;'>self</span>):
        <span style='color:#017a31;'># Initial conditions</span>
        <span style='color:#3605fb;'>self</span>.m.T.SetInitialCondition(<span style='color:#cc047c;'>293.15</span> <b><span style='color:#0000ff;'>*</span></b> K)
        <span style='color:#3605fb;'>self</span>.m.c.SetInitialCondition(<span style='color:#cc047c;'>0.275395968</span> <b><span style='color:#0000ff;'>*</span></b> kg<b><span style='color:#0000ff;'>/</span></b>kg)
        
        <span style='color:#017a31;'># Actung, Achtung!!</span>
        <span style='color:#017a31;'># Initial moments for 1.0081g of 125-250um seed (as in Niall's paper)</span>
        <span style='color:#017a31;'># The meaning of the above: the values are given in m**k per gram of paracetamol,</span>
        <span style='color:#017a31;'># and need to be transformed into the values in m**k/m**3</span>
        m_seed <b><span style='color:#0000ff;'>=</span></b> numpy.array([<span style='color:#cc047c;'>514967.2105</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>0</span>)<b><span style='color:#0000ff;'>/</span></b>g,
                              <span style='color:#cc047c;'>42.56573654</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>1</span>)<b><span style='color:#0000ff;'>/</span></b>g,
                              <span style='color:#cc047c;'>0.005234078</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>2</span>)<b><span style='color:#0000ff;'>/</span></b>g,
                              <span style='color:#cc047c;'>8.84516e-07</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>3</span>)<b><span style='color:#0000ff;'>/</span></b>g,
                              <span style='color:#cc047c;'>1.90332e-10</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>4</span>)<b><span style='color:#0000ff;'>/</span></b>g,
                              <span style='color:#cc047c;'>5.00159e-14</span> <b><span style='color:#0000ff;'>*</span></b> (m<b><span style='color:#0000ff;'>**</span></b><span style='color:#cc047c;'>5</span>)<b><span style='color:#0000ff;'>/</span></b>g])
        moments <b><span style='color:#0000ff;'>=</span></b> [<span style='color:#3605fb;'>self</span>.m.m0, <span style='color:#3605fb;'>self</span>.m.m1, <span style='color:#3605fb;'>self</span>.m.m2, <span style='color:#3605fb;'>self</span>.m.m3, <span style='color:#3605fb;'>self</span>.m.m4, <span style='color:#3605fb;'>self</span>.m.m5]
        <span style='color:#017a31;'># a) Change to moments per kg of ethanol: m_seed /= rho_EtOH*V</span>
        <span style='color:#017a31;'>#    (in the Niall's paper moments are given in m**k/kg, therefore: m_seed /= 0.394 * g/kg)</span>
        <span style='color:#017a31;'># b) Change to moments per m3 of ethanol: m_seed *= V (we use moments standardly given in m**k/m**3)</span>
        <span style='color:#017a31;'># Also, the above numbers are given per one gram of seed - multiply the moments by actual weight of seed in grams</span>
        m_seed <b><span style='color:#0000ff;'>*=</span></b> (<span style='color:#cc047c;'>7.0109</span><b><span style='color:#0000ff;'>*</span></b>g) <b><span style='color:#0000ff;'>/</span></b> <span style='color:#3605fb;'>self</span>.m.V.GetQuantity()
        <span style='color:#017a31;'>#print m_seed</span>
        <b>for</b> k <b>in</b> <span style='color:#2a00d6;'>range</span>(<span style='color:#cc047c;'>0</span>, <span style='color:#3605fb;'>self</span>.m.Nm.NumberOfPoints):
            moments[k].SetInitialCondition(m_seed[k])

<b>def</b> run(<b><span style='color:#0000ff;'>**</span></b>kwargs):
    simulation <b><span style='color:#0000ff;'>=</span></b> simTutorial()
    relativeTolerance <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>1e-07</span>
    <span style='color:#3605fb;'>from</span> daetools.solvers.superlu <span style='color:#3605fb;'>import</span> pySuperLU <span style='color:#3605fb;'>as</span> superlu
    lasolver <b><span style='color:#0000ff;'>=</span></b> superlu.daeCreateSuperLUSolver()
    <b>return</b> daeActivity.simulate(simulation, reportingInterval <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>60</span>,
                                            timeHorizon       <b><span style='color:#0000ff;'>=</span></b> <span style='color:#cc047c;'>3000</span>,
                                            lasolver <b><span style='color:#0000ff;'>=</span></b> lasolver,
                                            relativeTolerance <b><span style='color:#0000ff;'>=</span></b> relativeTolerance,
                                            <b><span style='color:#0000ff;'>**</span></b>kwargs)

<b>if</b> <span style='color:#3605fb;'>__name__</span> <b><span style='color:#0000ff;'>==</span></b> <span style='color:#cc0000;'>&quot;__main__&quot;</span>:
    guiRun <b><span style='color:#0000ff;'>=</span></b> <span style='color:#3605fb;'>False</span> <b>if</b> (<span style='color:#2a00d6;'>len</span>(sys.argv) <b><span style='color:#0000ff;'>&gt;</span></b> <span style='color:#cc047c;'>1</span> <b>and</b> sys.argv[<span style='color:#cc047c;'>1</span>] <b><span style='color:#0000ff;'>==</span></b> <span style='color:#cc0000;'>'console'</span>) <b>else</b> <span style='color:#3605fb;'>True</span>
    run(guiRun <b><span style='color:#0000ff;'>=</span></b> guiRun)
</pre>
</body>
</html>
