<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>tutorial_che_7.py</title>
</head>
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<span style='color:#008000;'>#!/usr/bin/env python</span>
<span style='color:#008000;'># -*- coding: utf-8 -*-</span>

<span style='color:#008000;'>&quot;&quot;&quot;</span><span style='color:#008000;'>********************************************************************************</span>
<span style='color:#008000;'>                            tutorial_che_7.py</span>
<span style='color:#008000;'>                 DAE Tools: pyDAE module, www.daetools.com</span>
<span style='color:#008000;'>                 Copyright (C) Dragan Nikolic, 2016</span>
<span style='color:#008000;'>***********************************************************************************</span>
<span style='color:#008000;'>DAE Tools is free software; you can redistribute it and/or modify it under the</span>
<span style='color:#008000;'>terms of the GNU General Public License version 3 as published by the Free Software</span>
<span style='color:#008000;'>Foundation. DAE Tools is distributed in the hope that it will be useful, but WITHOUT</span>
<span style='color:#008000;'>ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<span style='color:#008000;'>PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>
<span style='color:#008000;'>You should have received a copy of the GNU General Public License along with the</span>
<span style='color:#008000;'>DAE Tools software; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span style='color:#008000;'>********************************************************************************</span><span style='color:#008000;'>&quot;&quot;&quot;</span>
__doc__ <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c00000;'>&quot;&quot;&quot;</span>
<span style='color:#c00000;'>Steady-state Plug Flow Reactor with energy balance and first order reaction:</span>

<span style='color:#c00000;'>.. code-block:: none</span>

<span style='color:#c00000;'>    A -&gt; B</span>

<span style='color:#c00000;'>The problem is example 9.4.3 from the section 9.4 Nonisothermal Plug Flow Reactor</span>
<span style='color:#c00000;'>from the following book:</span>

<span style='color:#c00000;'>- Davis M.E., Davis R.J. (2003) Fundamentals of Chemical Reaction Engineering.</span>
<span style='color:#c00000;'>  McGraw Hill, New York, US. ISBN 007245007X.</span>

<span style='color:#c00000;'>The dimensionless concentration plot:</span>

<span style='color:#c00000;'>.. image:: _static/tutorial_che_7-results.png</span>
<span style='color:#c00000;'>   :width: 500px</span>

<span style='color:#c00000;'>The dimensionless temperature plot (adiabatic and nonisothermal cases):</span>

<span style='color:#c00000;'>.. image:: _static/tutorial_che_7-results2.png</span>
<span style='color:#c00000;'>   :width: 500px</span>
<span style='color:#c00000;'>&quot;&quot;&quot;</span>

<span style='color:#0000ff;'>import</span> sys, numpy
<span style='color:#0000ff;'>from</span> daetools.pyDAE <span style='color:#0000ff;'>import</span> <b><span style='color:#0000ff;'>*</span></b>
<span style='color:#0000ff;'>from</span> time <span style='color:#0000ff;'>import</span> localtime, strftime
<span style='color:#008000;'># Standard variable types are defined in variable_types.py</span>
<span style='color:#0000ff;'>from</span> pyUnits <span style='color:#0000ff;'>import</span> m, kg, s, K, Pa, mol, J, W, kJ, kmol

K_t  <b><span style='color:#0000ff;'>=</span></b> daeVariableType(<span style='color:#c00000;'>&quot;k&quot;</span>,  s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#c000c0;'>1</span>), <span style='color:#c000c0;'>0</span>, <span style='color:#c000c0;'>1E20</span>, <span style='color:#c000c0;'>0</span>, <span style='color:#c000c0;'>1e-8</span>)

<b>class</b> modTutorial(daeModel):
    <b>def</b> <b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#0000ff;'>self</span>, Name, Parent <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>None</span>, Description <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c00000;'>&quot;&quot;</span>):
        daeModel.<b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#0000ff;'>self</span>, Name, Parent, Description)

        <span style='color:#008000;'># Domains</span>
        <span style='color:#0000ff;'>self</span>.z <b><span style='color:#0000ff;'>=</span></b> daeDomain(<span style='color:#c00000;'>&quot;z&quot;</span>, <span style='color:#0000ff;'>self</span>, m, <span style='color:#c00000;'>&quot;Axial domain&quot;</span>)

        <span style='color:#008000;'># Parameters</span>
        <span style='color:#0000ff;'>self</span>.T0    <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;T_0&quot;</span>,     K,         <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Inlet temperature&quot;</span>)
        <span style='color:#0000ff;'>self</span>.Ca0   <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;Ca0&quot;</span>,     mol<b><span style='color:#0000ff;'>/</span></b>m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>3</span>,  <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Inlet concentration of A&quot;</span>)
        <span style='color:#0000ff;'>self</span>.u     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;u&quot;</span>,       m<b><span style='color:#0000ff;'>/</span></b>s,       <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Velocity&quot;</span>)
        <span style='color:#0000ff;'>self</span>.A     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;A&quot;</span>,       s<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#c000c0;'>1</span>),   <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;A-&gt;B pre-exponential factor&quot;</span>)
        <span style='color:#0000ff;'>self</span>.Ea    <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;Ea&quot;</span>,      J<b><span style='color:#0000ff;'>/</span></b>mol,     <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;A-&gt;B activation energy&quot;</span>)
        <span style='color:#0000ff;'>self</span>.dHra  <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;dHra&quot;</span>,    J<b><span style='color:#0000ff;'>/</span></b>mol,     <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Heat of reaction A-&gt;B&quot;</span>)
        <span style='color:#0000ff;'>self</span>.rho   <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;&amp;rho;&quot;</span>,   kg<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>3</span>), <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Density&quot;</span>)
        <span style='color:#0000ff;'>self</span>.cp    <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;c_p&quot;</span>,     J<b><span style='color:#0000ff;'>/</span></b>(kg<b><span style='color:#0000ff;'>*</span></b>K),  <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Heat capacity&quot;</span>)
        <span style='color:#0000ff;'>self</span>.Tj    <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;Tj&quot;</span>,      K,         <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Cooling jacket temperature&quot;</span>)
        <span style='color:#0000ff;'>self</span>.aj    <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;aj&quot;</span>,      m<b><span style='color:#0000ff;'>**</span></b>(<b><span style='color:#0000ff;'>-</span></b><span style='color:#c000c0;'>1</span>),   <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Cooling jacket specific surface area (area/volume)&quot;</span>)
        <span style='color:#0000ff;'>self</span>.U     <b><span style='color:#0000ff;'>=</span></b> daeParameter(<span style='color:#c00000;'>&quot;U&quot;</span>,       W<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>2</span><b><span style='color:#0000ff;'>*</span></b>K),<span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Cooling jacket heat transfer coefficient&quot;</span>)

        <span style='color:#008000;'># Variables</span>
        <span style='color:#0000ff;'>self</span>.tau_r <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;tau_r&quot;</span>,   time_t,                <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Residence time&quot;</span>)
        <span style='color:#0000ff;'>self</span>.ka    <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;ka&quot;</span>,      K_t,                   <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Reaction A-&gt;B rate constant&quot;</span>,      [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.Ca    <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;Ca&quot;</span>,      molar_concentration_t, <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Concentration of A&quot;</span>,               [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.ra    <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;ra&quot;</span>,      molar_reaction_rate_t, <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Reaction A-&gt;B rate&quot;</span>,               [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.T     <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;T&quot;</span>,       temperature_t,         <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Temperature in the reactor&quot;</span>,       [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.xa    <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;xa&quot;</span>,      fraction_t,            <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Conversion of A&quot;</span>,                  [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.ya    <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;ya&quot;</span>,      no_t,                  <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Dimensionless concentration of A&quot;</span>, [<span style='color:#0000ff;'>self</span>.z])
        <span style='color:#0000ff;'>self</span>.theta <b><span style='color:#0000ff;'>=</span></b> daeVariable(<span style='color:#c00000;'>&quot;theta&quot;</span>,   no_t,                  <span style='color:#0000ff;'>self</span>, <span style='color:#c00000;'>&quot;Dimensionless temperature&quot;</span>,        [<span style='color:#0000ff;'>self</span>.z])

    <b>def</b> DeclareEquations(<span style='color:#0000ff;'>self</span>):
        <span style='color:#008000;'># Create adouble objects to make equations more readable</span>
        Rg   <b><span style='color:#0000ff;'>=</span></b> Constant(<span style='color:#c000c0;'>8.314</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>(mol<b><span style='color:#0000ff;'>*</span></b>K))
        L    <b><span style='color:#0000ff;'>=</span></b> Constant(<span style='color:#0000ff;'>self</span>.z.UpperBound <b><span style='color:#0000ff;'>*</span></b> <span style='color:#0000ff;'>self</span>.z.Units) <span style='color:#008000;'># Reactor Length</span>
        u    <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.u()
        Ca0  <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.Ca0()
        T0   <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.T0()
        cp   <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.cp()
        rho  <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.rho()
        dHra <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.dHra()
        Tj   <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.Tj()
        U    <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.U()
        aj   <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.aj()
        Ea   <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.Ea()
        A    <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.A()

        <span style='color:#008000;'># Variables</span>
        tau_r <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.tau_r()
        <span style='color:#008000;'># Define functions (lambdas) to make equations more readable</span>
        ka      <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.ka(z)
        ra      <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.ra(z)
        xa      <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.xa(z)
        dxa_dt  <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: dt(<span style='color:#0000ff;'>self</span>.xa(z))
        dxa_dz  <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: d(<span style='color:#0000ff;'>self</span>.xa(z), <span style='color:#0000ff;'>self</span>.z)
        ya      <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.ya(z)
        theta   <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.theta(z)
        Ca      <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.Ca(z)
        dCa_dt  <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: dt(<span style='color:#0000ff;'>self</span>.Ca(z))
        dCa_dz  <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: d(<span style='color:#0000ff;'>self</span>.Ca(z), <span style='color:#0000ff;'>self</span>.z)
        d2Ca_dz2<b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: d2(<span style='color:#0000ff;'>self</span>.Ca(z), <span style='color:#0000ff;'>self</span>.z)
        T       <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: <span style='color:#0000ff;'>self</span>.T(z)
        dT_dt   <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: dt(<span style='color:#0000ff;'>self</span>.T(z))
        dT_dz   <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: d(<span style='color:#0000ff;'>self</span>.T(z), <span style='color:#0000ff;'>self</span>.z)
        d2T_dz2 <b><span style='color:#0000ff;'>=</span></b> <b>lambda</b> z: d2(<span style='color:#0000ff;'>self</span>.T(z), <span style='color:#0000ff;'>self</span>.z)

        <span style='color:#008000;'># Reaction rate constants</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;k1&quot;</span>, <span style='color:#c00000;'>&quot;&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eClosedClosed)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> ka(z) <b><span style='color:#0000ff;'>-</span></b> A <b><span style='color:#0000ff;'>*</span></b> Exp(<b><span style='color:#0000ff;'>-</span></b>Ea<b><span style='color:#0000ff;'>/</span></b>(Rg<b><span style='color:#0000ff;'>*</span></b>T(z)))

        <span style='color:#008000;'># Reaction rate</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;ra&quot;</span>, <span style='color:#c00000;'>&quot;Reaction A-&gt;B rate&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eClosedClosed)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> ra(z) <b><span style='color:#0000ff;'>-</span></b> ka(z)<b><span style='color:#0000ff;'>*</span></b>Ca(z)

        <span style='color:#008000;'># Conversion</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;xa&quot;</span>, <span style='color:#c00000;'>&quot;Conversion of A&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eClosedClosed)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> xa(z) <b><span style='color:#0000ff;'>*</span></b> Ca0 <b><span style='color:#0000ff;'>-</span></b> (Ca0 <b><span style='color:#0000ff;'>-</span></b> Ca(z))

        <span style='color:#008000;'># Dimensionless concentration of A</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;ya&quot;</span>, <span style='color:#c00000;'>&quot;Dimensionless concentration of A&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eClosedClosed)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> ya(z) <b><span style='color:#0000ff;'>*</span></b> Ca0 <b><span style='color:#0000ff;'>-</span></b> Ca(z)

        <span style='color:#008000;'># Conversion</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;theta&quot;</span>, <span style='color:#c00000;'>&quot;Dimensionless temperature&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eClosedClosed)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> theta(z) <b><span style='color:#0000ff;'>*</span></b> T0 <b><span style='color:#0000ff;'>-</span></b> T(z)

        <span style='color:#008000;'># Mass balance for the reactor</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;Ca&quot;</span>, <span style='color:#c00000;'>&quot;Mass balance for the reactor&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eOpenOpen)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> u<b><span style='color:#0000ff;'>*</span></b>dCa_dz(z) <b><span style='color:#0000ff;'>+</span></b> ra(z)

        <span style='color:#008000;'># Mass balance (step change inlet BCs)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;Ca_inlet&quot;</span>, <span style='color:#c00000;'>&quot;Inlet boundary conditions for Ca&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eLowerBound)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> Ca(z) <b><span style='color:#0000ff;'>-</span></b> Ca0

        <span style='color:#008000;'># Mass balance (outlet BCs)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;Ca_outlet&quot;</span>, <span style='color:#c00000;'>&quot;Outlet boundary conditions for Ca&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eUpperBound)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> dCa_dz(z)

        <span style='color:#008000;'># Energy balance for the reactor</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;T&quot;</span>, <span style='color:#c00000;'>&quot;Energy balance for the reactor&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eOpenOpen)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> u<b><span style='color:#0000ff;'>*</span></b>dT_dz(z) <b><span style='color:#0000ff;'>+</span></b> ra(z)<b><span style='color:#0000ff;'>*</span></b>dHra<b><span style='color:#0000ff;'>/</span></b>(rho<b><span style='color:#0000ff;'>*</span></b>cp) <b><span style='color:#0000ff;'>+</span></b> U<b><span style='color:#0000ff;'>*</span></b>aj<b><span style='color:#0000ff;'>*</span></b>(T(z)<b><span style='color:#0000ff;'>-</span></b>Tj)<b><span style='color:#0000ff;'>/</span></b>(rho<b><span style='color:#0000ff;'>*</span></b>cp)

        <span style='color:#008000;'># Heat balance (step change inlet BCs)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;T_inlet&quot;</span>, <span style='color:#c00000;'>&quot;Inlet boundary conditions for T&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eLowerBound)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> T(z) <b><span style='color:#0000ff;'>-</span></b> T0

        <span style='color:#008000;'># Heat balance (outlet BCs)</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;T_outlet&quot;</span>, <span style='color:#c00000;'>&quot;Outlet boundary conditions for T&quot;</span>)
        z <b><span style='color:#0000ff;'>=</span></b> eq.DistributeOnDomain(<span style='color:#0000ff;'>self</span>.z, eUpperBound)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> dT_dz(z)

        <span style='color:#008000;'># Residence time</span>
        eq <b><span style='color:#0000ff;'>=</span></b> <span style='color:#0000ff;'>self</span>.CreateEquation(<span style='color:#c00000;'>&quot;ResidenceTime&quot;</span>, <span style='color:#c00000;'>&quot;Residence time of the reactor&quot;</span>)
        eq.Residual <b><span style='color:#0000ff;'>=</span></b> tau_r <b><span style='color:#0000ff;'>*</span></b> u <b><span style='color:#0000ff;'>-</span></b> L

<b>class</b> simTutorial(daeSimulation):
    <b>def</b> <b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#0000ff;'>self</span>):
        daeSimulation.<b><span style='color:#000e52;'>__init__</span></b>(<span style='color:#0000ff;'>self</span>)
        <span style='color:#0000ff;'>self</span>.m <b><span style='color:#0000ff;'>=</span></b> modTutorial(<span style='color:#c00000;'>&quot;tutorial_che_7&quot;</span>)
        <span style='color:#0000ff;'>self</span>.m.Description <b><span style='color:#0000ff;'>=</span></b> __doc__

    <b>def</b> SetUpParametersAndDomains(<span style='color:#0000ff;'>self</span>):
        <span style='color:#0000ff;'>self</span>.m.z.CreateStructuredGrid(<span style='color:#c000c0;'>50</span>, <span style='color:#c000c0;'>0.0</span>, <span style='color:#c000c0;'>2.0</span>)

        <span style='color:#008000;'># Notate bene:</span>
        <span style='color:#008000;'>#   Ea is 100 kJ/mol in the book but ka is 1E-7 then (too small).</span>
        <span style='color:#008000;'>#   dHra is 1E4 kJ/kmol in the book but the heat effect is too small.</span>
        <span style='color:#008000;'>#   U is 70 W/(m**2*K) in the book but the heat transferred is too low.</span>
        <span style='color:#008000;'># The values below reproduces the results from the book.</span>
        <span style='color:#008000;'># Definitely there are some typos in the values/units in the book.</span>
        <span style='color:#0000ff;'>self</span>.m.u.SetValue(<span style='color:#c000c0;'>3</span> <b><span style='color:#0000ff;'>*</span></b> m<b><span style='color:#0000ff;'>/</span></b>s)
        <span style='color:#0000ff;'>self</span>.m.Ca0.SetValue(<span style='color:#c000c0;'>300</span> <b><span style='color:#0000ff;'>*</span></b> mol<b><span style='color:#0000ff;'>/</span></b>m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>3</span>)
        <span style='color:#0000ff;'>self</span>.m.A.SetValue(<span style='color:#c000c0;'>5</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#c000c0;'>1</span><b><span style='color:#0000ff;'>/</span></b>s)
        <span style='color:#0000ff;'>self</span>.m.Ea.SetValue(<span style='color:#c000c0;'>100</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>mol) <span style='color:#008000;'># Nota Bene</span>
        <span style='color:#0000ff;'>self</span>.m.T0.SetValue(<span style='color:#c000c0;'>700</span> <b><span style='color:#0000ff;'>*</span></b> K)
        <span style='color:#0000ff;'>self</span>.m.rho.SetValue(<span style='color:#c000c0;'>1200</span> <b><span style='color:#0000ff;'>*</span></b> kg<b><span style='color:#0000ff;'>/</span></b>m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>3</span>)
        <span style='color:#0000ff;'>self</span>.m.cp.SetValue(<span style='color:#c000c0;'>1000</span> <b><span style='color:#0000ff;'>*</span></b> J<b><span style='color:#0000ff;'>/</span></b>(kg<b><span style='color:#0000ff;'>*</span></b>K))
        <span style='color:#0000ff;'>self</span>.m.dHra.SetValue(<b><span style='color:#0000ff;'>-</span></b><span style='color:#c000c0;'>1000</span> <b><span style='color:#0000ff;'>*</span></b> kJ<b><span style='color:#0000ff;'>/</span></b>mol) <span style='color:#008000;'># Nota Bene</span>
        <span style='color:#0000ff;'>self</span>.m.Tj.SetValue(<span style='color:#c000c0;'>700</span> <b><span style='color:#0000ff;'>*</span></b> K)
        <span style='color:#0000ff;'>self</span>.m.aj.SetValue(<span style='color:#c000c0;'>4</span><b><span style='color:#0000ff;'>/</span></b><span style='color:#c000c0;'>0.2</span> <b><span style='color:#0000ff;'>*</span></b> <span style='color:#c000c0;'>1</span><b><span style='color:#0000ff;'>/</span></b>m)
        <span style='color:#0000ff;'>self</span>.m.U.SetValue(<span style='color:#c000c0;'>70000</span> <b><span style='color:#0000ff;'>*</span></b> W<b><span style='color:#0000ff;'>/</span></b>(m<b><span style='color:#0000ff;'>**</span></b><span style='color:#c000c0;'>2</span><b><span style='color:#0000ff;'>*</span></b>K)) <span style='color:#008000;'># Nota Bene</span>

    <b>def</b> SetUpVariables(<span style='color:#0000ff;'>self</span>):
        <b>pass</b>

<span style='color:#008000;'># Use daeSimulator class</span>
<b>def</b> guiRun(app):
    simulation <b><span style='color:#0000ff;'>=</span></b> simTutorial()
    simulation.m.SetReportingOn(<span style='color:#0000ff;'>True</span>)
    simulation.ReportingInterval <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c000c0;'>5</span>
    simulation.TimeHorizon       <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c000c0;'>200</span>
    simulator <b><span style='color:#0000ff;'>=</span></b> daeSimulator(app, simulation <b><span style='color:#0000ff;'>=</span></b> simulation)
    simulator.exec_()

<span style='color:#008000;'># Setup everything manually and run in a console</span>
<b>def</b> consoleRun():
    <span style='color:#008000;'># Create Log, Solver, DataReporter and Simulation object</span>
    log          <b><span style='color:#0000ff;'>=</span></b> daePythonStdOutLog()
    daesolver    <b><span style='color:#0000ff;'>=</span></b> daeIDAS()
    datareporter <b><span style='color:#0000ff;'>=</span></b> daeTCPIPDataReporter()
    simulation   <b><span style='color:#0000ff;'>=</span></b> simTutorial()

    daesolver.RelativeTolerance <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c000c0;'>1e-5</span>

    <span style='color:#008000;'># Enable reporting of all variables</span>
    simulation.m.SetReportingOn(<span style='color:#0000ff;'>True</span>)

    <span style='color:#008000;'># Set the time horizon and the reporting interval</span>
    simulation.ReportingInterval <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c000c0;'>0.1</span>
    simulation.TimeHorizon       <b><span style='color:#0000ff;'>=</span></b> <span style='color:#c000c0;'>10</span>

    <span style='color:#008000;'># Connect data reporter</span>
    simName <b><span style='color:#0000ff;'>=</span></b> simulation.m.Name <b><span style='color:#0000ff;'>+</span></b> strftime(<span style='color:#c00000;'>&quot; [</span><span style='color:#0057ae;'>%d</span><span style='color:#c00000;'>.%m.%Y %H:%M:%S]&quot;</span>, localtime())
    <b>if</b>(datareporter.Connect(<span style='color:#c00000;'>&quot;&quot;</span>, simName) <b><span style='color:#0000ff;'>==</span></b> <span style='color:#0000ff;'>False</span>):
        sys.exit()

    <span style='color:#008000;'># Initialize the simulation</span>
    simulation.Initialize(daesolver, datareporter, log)

    <span style='color:#008000;'># Save the model report and the runtime model report</span>
    simulation.m.SaveModelReport(simulation.m.Name <b><span style='color:#0000ff;'>+</span></b> <span style='color:#c00000;'>&quot;.xml&quot;</span>)
    simulation.m.SaveRuntimeModelReport(simulation.m.Name <b><span style='color:#0000ff;'>+</span></b> <span style='color:#c00000;'>&quot;-rt.xml&quot;</span>)

    <span style='color:#008000;'># Solve at time=0 (initialization)</span>
    simulation.SolveInitial()

    <span style='color:#008000;'># Run</span>
    simulation.Run()
    simulation.Finalize()

<b>if</b> <span style='color:#0000ff;'>__name__</span> <b><span style='color:#0000ff;'>==</span></b> <span style='color:#c00000;'>&quot;__main__&quot;</span>:
    <b>if</b> <span style='color:#0000ff;'>len</span>(sys.argv) <b><span style='color:#0000ff;'>&gt;</span></b> <span style='color:#c000c0;'>1</span> <b><span style='color:#0000ff;'>and</span></b> (sys.argv[<span style='color:#c000c0;'>1</span>] <b><span style='color:#0000ff;'>==</span></b> <span style='color:#c00000;'>'console'</span>):
        consoleRun()
    <b>else</b>:
        <span style='color:#0000ff;'>from</span> PyQt4 <span style='color:#0000ff;'>import</span> QtCore, QtGui
        app <b><span style='color:#0000ff;'>=</span></b> QtGui.QApplication(sys.argv)
        guiRun(app)
</pre>
</body>
</html>
