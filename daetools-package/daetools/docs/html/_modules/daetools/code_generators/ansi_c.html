
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>daetools.code_generators.ansi_c &mdash; DAE Tools Project 1.3.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/[d][a][e].ico"/>
    <link rel="top" title="DAE Tools Project 1.3.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">DAE Tools Project 1.3.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for daetools.code_generators.ansi_c</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">daetools.pyDAE</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">formatter</span> <span class="kn">import</span> <span class="n">daeExpressionFormatter</span>
<span class="kn">from</span> <span class="nn">analyzer</span> <span class="kn">import</span> <span class="n">daeCodeGeneratorAnalyzer</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Compile with:</span>
<span class="sd">  g++ -O3 -Wall -o daetools_simulation adouble.cpp main.cpp</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">mainTemplate</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">/***********************************************************************************</span>
<span class="s">                 DAE Tools Project: www.daetools.com</span>
<span class="s">                 Copyright (C) Dragan Nikolic, 2010</span>
<span class="s">************************************************************************************</span>
<span class="s">DAE Tools is free software; you can redistribute it and/or modify it under the</span>
<span class="s">terms of the GNU General Public License version 3 as published by the Free Software</span>
<span class="s">Foundation. DAE Tools is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="s">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<span class="s">PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>
<span class="s">You should have received a copy of the GNU General Public License along with the</span>
<span class="s">DAE Tools software; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="s">***********************************************************************************/</span>
<span class="s">#ifndef DAETOOLS_MODEL_H</span>
<span class="s">#define DAETOOLS_MODEL_H</span>

<span class="s">#ifdef __cplusplus</span>
<span class="s">extern &quot;C&quot; {</span>
<span class="s">#endif</span>

<span class="s">/* ANSI C CODE GENERATOR WARNINGS!!!</span>
<span class="si">%(warnings)s</span><span class="s"></span>
<span class="s">*/</span>

<span class="s">#include &quot;auxiliary.h&quot;</span>
<span class="s">#include &quot;adouble.h&quot;</span>

<span class="s">#define _v_(i)   _adouble_(_values_[i],           (i == _current_index_for_jacobian_evaluation_) ? 1.0 : 0.0)</span>
<span class="s">#define _dt_(i)  _adouble_(_time_derivatives_[i], (i == _current_index_for_jacobian_evaluation_) ? _inverse_time_step_ : 0.0)</span>
<span class="s">#define _time_   _adouble_(_current_time_, 0.0)</span>

<span class="s">typedef struct</span>
<span class="s">{</span>
<span class="s">    real_t* values;</span>
<span class="s">    real_t* timeDerivatives;</span>
<span class="s">    </span><span class="si">%(floatValuesReferences)s</span><span class="s"></span>
<span class="s">    </span><span class="si">%(stringValuesReferences)s</span><span class="s"></span>

<span class="s">    /* Domains and parameters */</span>
<span class="s">    </span><span class="si">%(parameters)s</span><span class="s"></span>

<span class="s">    /* Assigned variables */</span>
<span class="s">    </span><span class="si">%(assignedVariablesDefs)s</span><span class="s"></span>

<span class="s">    /* StateTransitionNetworks */</span>
<span class="s">    </span><span class="si">%(activeStates)s</span><span class="s"></span>

<span class="s">} daetools_model_t;</span>

<span class="s">void initialize_model(daetools_model_t* _m_);</span>
<span class="s">void initialize_values_references(daetools_model_t* _m_);</span>
<span class="s">void set_initial_conditions(real_t* values);</span>
<span class="s">void get_float_value(daetools_model_t* _m_, int index, real_t* value);</span>
<span class="s">void set_float_value(daetools_model_t* _m_, int index, real_t value);</span>
<span class="s">void get_string_value(daetools_model_t* _m_, int index, char* value);</span>
<span class="s">void set_string_value(daetools_model_t* _m_, int index, const char* value);</span>

<span class="s">int residuals(daetools_model_t* _m_,</span>
<span class="s">              real_t _current_time_,</span>
<span class="s">              real_t* _values_,</span>
<span class="s">              real_t* _time_derivatives_,</span>
<span class="s">              real_t* _residuals_);</span>
<span class="s">int jacobian(daetools_model_t* _m_,</span>
<span class="s">             long int _number_of_equations_,</span>
<span class="s">             real_t _current_time_,</span>
<span class="s">             real_t _inverse_time_step_,</span>
<span class="s">             real_t* _values_,</span>
<span class="s">             real_t* _time_derivatives_,</span>
<span class="s">             real_t* _residuals_,</span>
<span class="s">             matrix_t _jacobian_matrix_);</span>
<span class="s">int number_of_roots(daetools_model_t* _m_);</span>
<span class="s">int roots(daetools_model_t* _m_,</span>
<span class="s">          real_t _current_time_,</span>
<span class="s">          real_t* _values_,</span>
<span class="s">          real_t* _time_derivatives_,</span>
<span class="s">          real_t* _roots_);</span>
<span class="s">bool check_for_discontinuities(daetools_model_t* _m_,</span>
<span class="s">                               real_t _current_time_,</span>
<span class="s">                               real_t* _values_,</span>
<span class="s">                               real_t* _time_derivatives_);</span>
<span class="s">bool execute_actions(daetools_model_t* _m_,</span>
<span class="s">                     real_t _current_time_,</span>
<span class="s">                     real_t* _values_,</span>
<span class="s">                     real_t* _time_derivatives_);</span>

<span class="s">/* General info */          </span>
<span class="si">%(model)s</span><span class="s"></span>

<span class="s">void initialize_model(daetools_model_t* _m_)</span>
<span class="s">{</span>
<span class="s">    </span><span class="si">%(parametersInits)s</span><span class="s"></span>
<span class="s">    </span><span class="si">%(assignedVariablesInits)s</span><span class="s"></span>
<span class="s">}</span>

<span class="s">void set_initial_conditions(real_t* values)</span>
<span class="s">{</span>
<span class="s">    </span><span class="si">%(initialConditions)s</span><span class="s"></span>
<span class="s">}</span>

<span class="s">int residuals(daetools_model_t* _m_,</span>
<span class="s">              real_t _current_time_,</span>
<span class="s">              real_t* _values_,</span>
<span class="s">              real_t* _time_derivatives_,</span>
<span class="s">              real_t* _residuals_)</span>
<span class="s">{</span>
<span class="s">    adouble _temp_;</span>
<span class="s">    real_t _inverse_time_step_;</span>
<span class="s">    int i, _ec_, _current_index_for_jacobian_evaluation_;</span>
<span class="s">    </span>
<span class="s">    _ec_                                    = 0;</span>
<span class="s">    _current_index_for_jacobian_evaluation_ = -1;</span>
<span class="s">    _inverse_time_step_                     = 0.0;</span>

<span class="si">%(residuals)s</span><span class="s"></span>

<span class="s">    return 0;</span>
<span class="s">}</span>

<span class="s">int jacobian(daetools_model_t* _m_,</span>
<span class="s">             long int _number_of_equations_,</span>
<span class="s">             real_t _current_time_,</span>
<span class="s">             real_t _inverse_time_step_,</span>
<span class="s">             real_t* _values_,</span>
<span class="s">             real_t* _time_derivatives_,</span>
<span class="s">             real_t* _residuals_,</span>
<span class="s">             matrix_t _jacobian_matrix_)</span>
<span class="s">{</span>
<span class="s">    adouble _temp_;</span>
<span class="s">    real_t _jacobianItem_;</span>
<span class="s">    int _i_, _ec_, _block_index_, _current_index_for_jacobian_evaluation_;</span>

<span class="s">    _ec_                                    = 0;</span>
<span class="s">    _current_index_for_jacobian_evaluation_ = -1;</span>
<span class="s">    </span>
<span class="si">%(jacobian)s</span><span class="s"></span>

<span class="s">    return 0;</span>
<span class="s">}</span>

<span class="s">int number_of_roots(daetools_model_t* _m_)</span>
<span class="s">{</span>
<span class="s">    int _noRoots_;</span>

<span class="s">    _noRoots_ = 0;</span>
<span class="s">    </span>
<span class="si">%(numberOfRoots)s</span><span class="s"></span>

<span class="s">    return _noRoots_;</span>
<span class="s">}</span>

<span class="s">int roots(daetools_model_t* _m_,</span>
<span class="s">          real_t _current_time_,</span>
<span class="s">          real_t* _values_,</span>
<span class="s">          real_t* _time_derivatives_,</span>
<span class="s">          real_t* _roots_)</span>
<span class="s">{</span>
<span class="s">    adouble _temp_;</span>
<span class="s">    real_t _inverse_time_step_;</span>
<span class="s">    int _rc_, _current_index_for_jacobian_evaluation_;</span>
<span class="s">    </span>
<span class="s">    _rc_                                    = 0;</span>
<span class="s">    _inverse_time_step_                     = 0.0;</span>
<span class="s">    _current_index_for_jacobian_evaluation_ = -1;</span>
<span class="s">    </span>
<span class="si">%(roots)s</span><span class="s"></span>

<span class="s">    return 0;</span>
<span class="s">}</span>

<span class="s">bool check_for_discontinuities(daetools_model_t* _m_,</span>
<span class="s">                               real_t _current_time_,</span>
<span class="s">                               real_t* _values_,</span>
<span class="s">                               real_t* _time_derivatives_)</span>
<span class="s">{</span>
<span class="s">    adouble _temp_;</span>
<span class="s">    bool foundDiscontinuity;</span>
<span class="s">    real_t _inverse_time_step_;</span>
<span class="s">    int _current_index_for_jacobian_evaluation_;</span>

<span class="s">    _inverse_time_step_                     = 0.0;</span>
<span class="s">    _current_index_for_jacobian_evaluation_ = -1;</span>
<span class="s">    foundDiscontinuity                      = false;</span>
<span class="s">    </span>
<span class="si">%(checkForDiscontinuities)s</span><span class="s"></span>

<span class="s">    return foundDiscontinuity;</span>
<span class="s">}</span>

<span class="s">bool execute_actions(daetools_model_t* _m_,</span>
<span class="s">                     real_t _current_time_,</span>
<span class="s">                     real_t* _values_,</span>
<span class="s">                     real_t* _time_derivatives_)</span>
<span class="s">{</span>
<span class="s">    adouble _temp_;</span>
<span class="s">    real_t _inverse_time_step_;</span>
<span class="s">    bool _copy_values_to_solver_;</span>
<span class="s">    int _current_index_for_jacobian_evaluation_;</span>

<span class="s">    _inverse_time_step_                     = 0.0;</span>
<span class="s">    _current_index_for_jacobian_evaluation_ = -1;</span>
<span class="s">    _copy_values_to_solver_                 = false;</span>

<span class="si">%(executeActions)s</span><span class="s"></span>

<span class="s">    return _copy_values_to_solver_;</span>
<span class="s">}</span>

<span class="s">void initialize_values_references(daetools_model_t* _m_)</span>
<span class="s">{</span>
<span class="s">    /*</span>
<span class="s">    Values references is an array of pointers that point to the values</span>
<span class="s">    of parametere/variables in the daetools_model_t structure.</span>
<span class="s">    Can be uset to set/get values from the model (ie. for FMI).</span>
<span class="s">    */</span>
<span class="s">    </span><span class="si">%(valuesReferencesInit)s</span><span class="s"></span>
<span class="s">}</span>

<span class="s">void get_float_value(daetools_model_t* _m_, int index, real_t* value)</span>
<span class="s">{</span>
<span class="s">    *value = *_m_-&gt;floatValuesReferences[index];</span>
<span class="s">}</span>

<span class="s">void set_float_value(daetools_model_t* _m_, int index, real_t value)</span>
<span class="s">{</span>
<span class="s">    *_m_-&gt;floatValuesReferences[index] = value;</span>
<span class="s">}</span>

<span class="s">void get_string_value(daetools_model_t* _m_, int index, char* value)</span>
<span class="s">{</span>
<span class="s">    *value = _m_-&gt;stringValuesReferences[index];</span>
<span class="s">}</span>

<span class="s">void set_string_value(daetools_model_t* _m_, int index, const char* value)</span>
<span class="s">{</span>
<span class="s">    _m_-&gt;stringValuesReferences[index] = value;</span>
<span class="s">}</span>

<span class="s">#ifdef __cplusplus</span>
<span class="s">}</span>
<span class="s">#endif</span>

<span class="s">#endif</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="daeANSICExpressionFormatter"><a class="viewcode-back" href="../../../code_generators.html#daetools.code_generators.ansi_c.daeANSICExpressionFormatter">[docs]</a><span class="k">class</span> <span class="nc">daeANSICExpressionFormatter</span><span class="p">(</span><span class="n">daeExpressionFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">daeExpressionFormatter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexBase</span>                              <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useFlattenedNamesForAssignedVariables</span>  <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span>                                    <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexMap</span>                               <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Use relative names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useRelativeNames</span>         <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattenIdentifiers</span>       <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>                   <span class="o">=</span> <span class="s">&#39;_adouble_(_m_-&gt;{domain}[{index}], 0)&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span>                <span class="o">=</span> <span class="s">&#39;_adouble_(_m_-&gt;{parameter}{indexes}, 0)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterIndexStart</span>      <span class="o">=</span> <span class="s">&#39;[&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterIndexEnd</span>        <span class="o">=</span> <span class="s">&#39;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterIndexDelimiter</span>  <span class="o">=</span> <span class="s">&#39;][&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>                 <span class="o">=</span> <span class="s">&#39;_v_({blockIndex})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableIndexStart</span>       <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableIndexEnd</span>         <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableIndexDelimiter</span>   <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariable</span>         <span class="o">=</span> <span class="s">&#39;_adouble_(_m_-&gt;{variable}, 0)&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span>               <span class="o">=</span> <span class="s">&#39;_dt_({blockIndex})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivativeIndexStart</span>     <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivativeIndexEnd</span>       <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivativeIndexDelimiter</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="s">&#39;_adouble_({value}, 0)&#39;</span>

        <span class="c"># Logical operators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AND</span>   <span class="o">=</span> <span class="s">&#39;_and_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OR</span>    <span class="o">=</span> <span class="s">&#39;_or_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NOT</span>   <span class="o">=</span> <span class="s">&#39;_not_({value})&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EQ</span>    <span class="o">=</span> <span class="s">&#39;_eq_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NEQ</span>   <span class="o">=</span> <span class="s">&#39;_neq_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LT</span>    <span class="o">=</span> <span class="s">&#39;_lt_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LTEQ</span>  <span class="o">=</span> <span class="s">&#39;_lteq_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GT</span>    <span class="o">=</span> <span class="s">&#39;_gt_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GTEQ</span>  <span class="o">=</span> <span class="s">&#39;_gteq_({leftValue}, {rightValue})&#39;</span>

        <span class="c"># Mathematical operators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SIGN</span>   <span class="o">=</span> <span class="s">&#39;_sign_({value})&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PLUS</span>   <span class="o">=</span> <span class="s">&#39;_plus_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MINUS</span>  <span class="o">=</span> <span class="s">&#39;_minus_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MULTI</span>  <span class="o">=</span> <span class="s">&#39;_multi_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIVIDE</span> <span class="o">=</span> <span class="s">&#39;_divide_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POWER</span>  <span class="o">=</span> <span class="s">&#39;_pow_({leftValue}, {rightValue})&#39;</span>

        <span class="c"># Mathematical functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SIN</span>    <span class="o">=</span> <span class="s">&#39;_sin_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">COS</span>    <span class="o">=</span> <span class="s">&#39;_cos_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAN</span>    <span class="o">=</span> <span class="s">&#39;_tan_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASIN</span>   <span class="o">=</span> <span class="s">&#39;_asin_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACOS</span>   <span class="o">=</span> <span class="s">&#39;_acos_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ATAN</span>   <span class="o">=</span> <span class="s">&#39;_atan_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXP</span>    <span class="o">=</span> <span class="s">&#39;_exp_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SQRT</span>   <span class="o">=</span> <span class="s">&#39;_sqrt_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LOG</span>    <span class="o">=</span> <span class="s">&#39;_log_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LOG10</span>  <span class="o">=</span> <span class="s">&#39;_log10_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FLOOR</span>  <span class="o">=</span> <span class="s">&#39;_floor_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CEIL</span>   <span class="o">=</span> <span class="s">&#39;_ceil_({value})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ABS</span>    <span class="o">=</span> <span class="s">&#39;_abs_({value})&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MIN</span>    <span class="o">=</span> <span class="s">&#39;_min_({leftValue}, {rightValue})&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX</span>    <span class="o">=</span> <span class="s">&#39;_max_({leftValue}, {rightValue})&#39;</span>

        <span class="c"># Current time in simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TIME</span>   <span class="o">=</span> <span class="s">&#39;_time_&#39;</span>

<div class="viewcode-block" id="daeANSICExpressionFormatter.formatNumpyArray"><a class="viewcode-back" href="../../../code_generators.html#daetools.code_generators.ansi_c.daeANSICExpressionFormatter.formatNumpyArray">[docs]</a>    <span class="k">def</span> <span class="nf">formatNumpyArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="daeANSICExpressionFormatter.formatQuantity"><a class="viewcode-back" href="../../../code_generators.html#daetools.code_generators.ansi_c.daeANSICExpressionFormatter.formatQuantity">[docs]</a>    <span class="k">def</span> <span class="nf">formatQuantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="c"># Formats constants/quantities in equations that have a value and units</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">quantity</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
     </div></div>
<div class="viewcode-block" id="daeCodeGenerator_ANSI_C"><a class="viewcode-back" href="../../../code_generators.html#daetools.code_generators.ansi_c.daeCodeGenerator_ANSI_C">[docs]</a><span class="k">class</span> <span class="nc">daeCodeGenerator_ANSI_C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span>     <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>           <span class="o">=</span> <span class="s">&#39;    &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span>                <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topLevelModel</span>           <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span>              <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesDefs</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesInits</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialConditions</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initiallyActiveStates</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span>                <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span>          <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span>         <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stringValuesReferences</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span>          <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span>           <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fmiInterface</span>            <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span> <span class="o">=</span> <span class="n">daeANSICExpressionFormatter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span>      <span class="o">=</span> <span class="n">daeCodeGeneratorAnalyzer</span><span class="p">()</span>

<div class="viewcode-block" id="daeCodeGenerator_ANSI_C.generateSimulation"><a class="viewcode-back" href="../../../code_generators.html#daetools.code_generators.ansi_c.daeCodeGenerator_ANSI_C.generateSimulation">[docs]</a>    <span class="k">def</span> <span class="nf">generateSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Invalid simulation object&#39;</span><span class="p">)</span>

        <span class="n">directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;projectDirectory&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesDefs</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesInits</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialConditions</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initiallyActiveStates</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span>                <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span>          <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span>         <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stringValuesReferences</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span>          <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span>                <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span>              <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topLevelModel</span>           <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span>     <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">Name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">modelCanonicalName</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">Name</span>

        <span class="n">indent</span>   <span class="o">=</span> <span class="mi">1</span>
        <span class="n">s_indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">analyzeSimulation</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">IDs</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;IDs&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;IndexMappings&#39;</span><span class="p">]</span>

        <span class="c">#import pprint</span>
        <span class="c">#pp = pprint.PrettyPrinter(indent=2)</span>
        <span class="c">#pp.pprint(self.analyzer.runtimeInformation)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generateRuntimeInformation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">runtimeInformation</span><span class="p">)</span>

        <span class="n">modelDef</span>          <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="p">)</span>
        <span class="n">paramsDef</span>         <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span><span class="p">)</span>
        <span class="n">paramsInits</span>       <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="p">)</span>
        <span class="n">stnDef</span>            <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initiallyActiveStates</span><span class="p">)</span>
        <span class="n">assignedVarsDefs</span>  <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesDefs</span><span class="p">)</span>
        <span class="n">assignedVarsInits</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesInits</span><span class="p">)</span>
        <span class="n">initConds</span>         <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialConditions</span><span class="p">)</span>
        <span class="n">eqnsRes</span>           <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">)</span>
        <span class="n">jacobRes</span>          <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="p">)</span>
        <span class="n">rootsDef</span>          <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="p">)</span>
        <span class="n">checkDiscont</span>      <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="p">)</span>
        <span class="n">execActionsDef</span>    <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="p">)</span>
        <span class="n">noRootsDef</span>        <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="p">)</span>
        <span class="n">warnings</span>          <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">floatValuesReferences</span> <span class="o">=</span> <span class="s">&#39;real_t* floatValuesReferences[{0}];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">floatValuesReferences</span> <span class="o">=</span> <span class="s">&#39;real_t* floatValuesReferences[1];&#39;</span> <span class="c"># dummy array</span>

        <span class="c"># FMI: initialize value references tuple: (ref_type, name)</span>
        <span class="n">valRefInit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ref_type</span><span class="p">,</span> <span class="n">ref_name</span><span class="p">,</span> <span class="n">ref_flat_name</span><span class="p">,</span> <span class="n">block_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;Assigned&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;{1};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ref_flat_name</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;Algebraic&#39;</span> <span class="ow">or</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;Differential&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;values[{1}];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">block_index</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;Differential&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;values[{1}];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">block_index</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;Parameter&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;{1};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ref_flat_name</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;NumberOfPointsInDomain&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;{1};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ref_flat_name</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ref_type</span> <span class="o">==</span> <span class="s">&#39;DomainPoints&#39;</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;floatValuesReferences[{0}] = &amp;_m_-&gt;{1};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ref_flat_name</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Invalid variable reference type&#39;</span><span class="p">)</span>
            
            <span class="n">valRefInit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>            
        <span class="n">valuesReferencesInit</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valRefInit</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stringValuesReferences</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stringValuesReferences</span> <span class="o">=</span> <span class="s">&#39;real_t* stringValuesReferences[{0}];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stringValuesReferences</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stringValuesReferences</span> <span class="o">=</span> <span class="s">&#39;real_t* stringValuesReferences[1];&#39;</span> <span class="c"># dummy array</span>
            
        <span class="n">dictInfo</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&#39;model&#39;</span> <span class="p">:</span> <span class="n">modelDef</span><span class="p">,</span>
                        <span class="s">&#39;parameters&#39;</span> <span class="p">:</span> <span class="n">paramsDef</span><span class="p">,</span>
                        <span class="s">&#39;parametersInits&#39;</span> <span class="p">:</span> <span class="n">paramsInits</span><span class="p">,</span>
                        <span class="s">&#39;valuesReferencesInit&#39;</span> <span class="p">:</span> <span class="n">valuesReferencesInit</span><span class="p">,</span>
                        <span class="s">&#39;floatValuesReferences&#39;</span> <span class="p">:</span> <span class="n">floatValuesReferences</span><span class="p">,</span>
                        <span class="s">&#39;stringValuesReferences&#39;</span> <span class="p">:</span> <span class="n">stringValuesReferences</span><span class="p">,</span>
                        <span class="s">&#39;activeStates&#39;</span> <span class="p">:</span> <span class="n">stnDef</span><span class="p">,</span>
                        <span class="s">&#39;assignedVariablesDefs&#39;</span> <span class="p">:</span> <span class="n">assignedVarsDefs</span><span class="p">,</span>
                        <span class="s">&#39;assignedVariablesInits&#39;</span> <span class="p">:</span> <span class="n">assignedVarsInits</span><span class="p">,</span>
                        <span class="s">&#39;initialConditions&#39;</span> <span class="p">:</span> <span class="n">initConds</span><span class="p">,</span>
                        <span class="s">&#39;residuals&#39;</span> <span class="p">:</span> <span class="n">eqnsRes</span><span class="p">,</span>
                        <span class="s">&#39;jacobian&#39;</span> <span class="p">:</span> <span class="n">jacobRes</span><span class="p">,</span>
                        <span class="s">&#39;roots&#39;</span> <span class="p">:</span> <span class="n">rootsDef</span><span class="p">,</span>
                        <span class="s">&#39;numberOfRoots&#39;</span> <span class="p">:</span> <span class="n">noRootsDef</span><span class="p">,</span>
                        <span class="s">&#39;checkForDiscontinuities&#39;</span> <span class="p">:</span> <span class="n">checkDiscont</span><span class="p">,</span>
                        <span class="s">&#39;executeActions&#39;</span> <span class="p">:</span> <span class="n">execActionsDef</span><span class="p">,</span>
                        <span class="s">&#39;warnings&#39;</span> <span class="p">:</span> <span class="n">warnings</span>
                   <span class="p">}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">mainTemplate</span> <span class="o">%</span> <span class="n">dictInfo</span><span class="p">;</span>

        <span class="n">ansic_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;ansic&#39;</span><span class="p">)</span>

        <span class="c"># If the argument &#39;directory&#39; is given create the folder and the project</span>
        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">dirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

            <span class="n">daetools_model_h</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;daetools_model.h&#39;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;main-dense.c&#39;</span><span class="p">),</span>   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;main.c&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;adouble.h&#39;</span><span class="p">),</span>      <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;adouble.h&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;adouble.c&#39;</span><span class="p">),</span>      <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;adouble.c&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;typedefs.h&#39;</span><span class="p">),</span>     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;typedefs.h&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;auxiliary.h&#39;</span><span class="p">),</span>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;auxiliary.h&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;auxiliary.c&#39;</span><span class="p">),</span>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;auxiliary.c&#39;</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansic_dir</span><span class="p">,</span> <span class="s">&#39;qt_project.pro&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;{0}.pro&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dirName</span><span class="p">)))</span>

            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">daetools_model_h</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;CODE GENERATOR WARNINGS:&#39;</span>
            <span class="k">print</span> <span class="n">warnings</span>
        
        <span class="k">return</span> <span class="n">results</span>
</div>
    <span class="k">def</span> <span class="nf">_processEquations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Equations</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="n">s_indent</span>  <span class="o">=</span> <span class="n">indent</span>     <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>
        <span class="n">s_indent2</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span> <span class="o">==</span> <span class="s">&#39;residuals&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">equation</span> <span class="ow">in</span> <span class="n">Equations</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">eeinfo</span> <span class="ow">in</span> <span class="n">equation</span><span class="p">[</span><span class="s">&#39;EquationExecutionInfos&#39;</span><span class="p">]:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeNode</span><span class="p">(</span><span class="n">eeinfo</span><span class="p">[</span><span class="s">&#39;ResidualRuntimeNode&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* Equation type: &#39;</span> <span class="o">+</span> <span class="n">eeinfo</span><span class="p">[</span><span class="s">&#39;EquationType&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; */&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_temp_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_residuals_[_ec_++] = _getValue_(&amp;_temp_);&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span> <span class="o">==</span> <span class="s">&#39;jacobian&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">equation</span> <span class="ow">in</span> <span class="n">Equations</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">eeinfo</span> <span class="ow">in</span> <span class="n">equation</span><span class="p">[</span><span class="s">&#39;EquationExecutionInfos&#39;</span><span class="p">]:</span>
                    <span class="n">overall_indexes</span> <span class="o">=</span> <span class="n">eeinfo</span><span class="p">[</span><span class="s">&#39;VariableIndexes&#39;</span><span class="p">]</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">overall_indexes</span><span class="p">)</span>
                    <span class="n">ID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="p">)</span>
                    <span class="n">block_indexes</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">overall_indexes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">oi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexMap</span><span class="p">:</span>
                            <span class="n">bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexBase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexMap</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">block_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bi</span><span class="p">)</span>
                    <span class="n">str_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">block_indexes</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;int _block_indexes_{0}[{1}] = {2};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">str_indexes</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;for(_i_ = 0; _i_ &lt; {0}; _i_++) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_block_index_ = _block_indexes_{0}[_i_];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ID</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_current_index_for_jacobian_evaluation_ = _block_index_;&#39;</span><span class="p">)</span>
                    
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeNode</span><span class="p">(</span><span class="n">eeinfo</span><span class="p">[</span><span class="s">&#39;ResidualRuntimeNode&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_temp_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_jacobianItem_ = _getDerivative_(&amp;_temp_);&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_set_matrix_item_(_jacobian_matrix_, _ec_, _block_index_, _jacobianItem_);&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_ec_++;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_processSTNs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">STNs</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="n">s_indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>
        <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">STNs</span><span class="p">:</span>
            <span class="n">nStates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;Class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;daeIF&#39;</span><span class="p">:</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;CanonicalName&#39;</span><span class="p">])</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
                <span class="n">stnVariableName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_ifstn&#39;</span>
                <span class="n">description</span>     <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;Description&#39;</span><span class="p">]</span>
                <span class="n">states</span>          <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">])</span>
                <span class="n">activeState</span>     <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;ActiveState&#39;</span><span class="p">]</span>

                <span class="n">varTemplate</span> <span class="o">=</span> <span class="s">&#39;char* {name} = &quot;{activeState}&quot;; /* States: {states}; {description} */ </span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initiallyActiveStates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">stnVariableName</span><span class="p">,</span>
                                                                     <span class="n">states</span> <span class="o">=</span> <span class="n">states</span><span class="p">,</span>
                                                                     <span class="n">activeState</span> <span class="o">=</span> <span class="n">activeState</span><span class="p">,</span>
                                                                     <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

                <span class="n">nStates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">]):</span>
                    <span class="c"># Not all states have state_transitions (&#39;else&#39; state has no state transitions)</span>
                    <span class="n">state_transition</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* IF {0} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                        <span class="n">state_transition</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeConditionNode</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;ConditionRuntimeNode&#39;</span><span class="p">])</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;if(_compare_strings_({0}, &quot;{1}&quot;)) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">nStates</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">state_transition</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeConditionNode</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;ConditionRuntimeNode&#39;</span><span class="p">])</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;else if(_compare_strings_({0}, &quot;{1}&quot;)) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;else if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;else {&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="c"># 1a. Put equations into the residuals list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;residuals&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 1b. Put equations into the jacobians list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;jacobian&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="n">nStateTransitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">])</span>
                    <span class="n">s_indent2</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>
                    <span class="n">s_indent3</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>

                    <span class="c"># 2. checkForDiscontinuities</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;if(! _compare_strings_({0}, &quot;{1}&quot;)) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent3</span> <span class="o">+</span> <span class="s">&#39;foundDiscontinuity = true;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 3. executeActions</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;printf(&quot;The state {0} from {1} is active now.</span><span class="se">\\</span><span class="s">n&quot;);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">],</span> <span class="n">stnVariableName</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;{0} = &quot;{1}&quot;;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 4. numberOfRoots</span>
                    <span class="k">if</span> <span class="n">state_transition</span><span class="p">:</span> <span class="c"># For &#39;else&#39; state has no state transitions</span>
                        <span class="n">nExpr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;Expressions&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_noRoots_ += {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nExpr</span><span class="p">))</span>

                    <span class="c"># 5. rootFunctions</span>
                    <span class="k">if</span> <span class="n">state_transition</span><span class="p">:</span> <span class="c"># For &#39;else&#39; state has no state transitions</span>
                        <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;Expressions&#39;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_temp_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeNode</span><span class="p">(</span><span class="n">expression</span><span class="p">)))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_roots_[_rc_++] = _getValue_(&amp;_temp_);&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;NestedSTNs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;C code cannot be generated for nested state transition networks&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;Class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;daeSTN&#39;</span><span class="p">:</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;CanonicalName&#39;</span><span class="p">])</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
                <span class="n">stnVariableName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_stn&#39;</span>
                <span class="n">description</span>     <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;Description&#39;</span><span class="p">]</span>
                <span class="n">states</span>          <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">])</span>
                <span class="n">activeState</span>     <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="s">&#39;ActiveState&#39;</span><span class="p">]</span>

                <span class="n">varTemplate</span> <span class="o">=</span> <span class="s">&#39;char* {name} = &quot;{activeState}&quot;; /* States: {states}; {description} */ </span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initiallyActiveStates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">stnVariableName</span><span class="p">,</span>
                                                                     <span class="n">states</span> <span class="o">=</span> <span class="n">states</span><span class="p">,</span>
                                                                     <span class="n">activeState</span> <span class="o">=</span> <span class="n">activeState</span><span class="p">,</span>
                                                                     <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

                <span class="n">nStates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s">&#39;States&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* STN {0} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;if(_compare_strings_({0}, &quot;{1}&quot;)) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">nStates</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;else if(_compare_strings_({0}, &quot;{1}&quot;)) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;else {&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="c"># 1. Put equations into the residuals list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;residuals&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 1b. Put equations into the jacobians list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;jacobian&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="n">nStateTransitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">])</span>
                    <span class="n">s_indent2</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>
                    <span class="n">s_indent3</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>

                    <span class="c"># 2. checkForDiscontinuities</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state_transition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">]):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeConditionNode</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;ConditionRuntimeNode&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent3</span> <span class="o">+</span> <span class="s">&#39;foundDiscontinuity = true;&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">nStates</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;else if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent3</span> <span class="o">+</span> <span class="s">&#39;foundDiscontinuity = true;&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;else {&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent3</span> <span class="o">+</span> <span class="s">&#39;foundDiscontinuity = true;&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">checkForDiscontinuities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>
                    
                    <span class="c"># 3. executeActions</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state_transition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">]):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeConditionNode</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;ConditionRuntimeNode&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>

                        <span class="k">elif</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">nStates</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;else if({0}) {{&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;else {&#39;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_processActions</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;Actions&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 4. numberOfRoots</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state_transition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">]):</span>
                        <span class="n">nExpr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;Expressions&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_noRoots_ += {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nExpr</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">numberOfRoots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="c"># 5. rootFunctions</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state_transition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;StateTransitions&#39;</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">state_transition</span><span class="p">[</span><span class="s">&#39;Expressions&#39;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_temp_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeNode</span><span class="p">(</span><span class="n">expression</span><span class="p">)))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent2</span> <span class="o">+</span> <span class="s">&#39;_roots_[_rc_++] = _getValue_(&amp;_temp_);&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">rootFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;NestedSTNs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;C code cannot be generated for nested state transition networks&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_processActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Actions</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="n">s_indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>

        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">Actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;eChangeState&#39;</span><span class="p">:</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;STNCanonicalName&#39;</span><span class="p">])</span>
                <span class="n">relativeName</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
                <span class="n">stnVariableName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_stn&#39;</span>
                <span class="n">stateTo</span>         <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;StateTo&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_log_message_(&quot;The state [{0}] in STN [{1}] is active now.</span><span class="se">\\</span><span class="s">n&quot;);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stateTo</span><span class="p">,</span> <span class="n">stnVariableName</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;{0} = &quot;{1}&quot;;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnVariableName</span><span class="p">,</span> <span class="n">stateTo</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;eSendEvent&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;C code cannot be generated for SendEvent actions - the model will not work as expected!!&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;eReAssignOrReInitializeVariable&#39;</span><span class="p">:</span>
                <span class="n">relativeName</span>  <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;VariableCanonicalName&#39;</span><span class="p">])</span>
                <span class="n">relativeName</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
                <span class="n">domainIndexes</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;DomainIndexes&#39;</span><span class="p">]</span>
                <span class="n">overallIndex</span>  <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;OverallIndex&#39;</span><span class="p">]</span>
                <span class="n">ID</span>            <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;ID&#39;</span><span class="p">]</span>
                <span class="n">node</span>          <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;RuntimeNode&#39;</span><span class="p">]</span>
                <span class="n">strDomainIndexes</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domainIndexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">strDomainIndexes</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                <span class="n">variableName</span> <span class="o">=</span> <span class="n">relativeName</span> <span class="o">+</span> <span class="n">strDomainIndexes</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatRuntimeNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_log_message_(&quot;The variable [{0}] new value is [{1}] now.</span><span class="se">\\</span><span class="s">n&quot;);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variableName</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_temp_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnDifferential</span><span class="p">:</span>
                    <span class="c"># Write a new value directly into the _values_ array</span>
                    <span class="c"># All actions that need this variable will use a new value.</span>
                    <span class="c"># Is that what we want??? Should be...</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_values_[{0}] = _getValue_(&amp;_temp_);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overallIndex</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnAssigned</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;{0} = _getValue_(&amp;_temp_);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variableName</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot reset a value of the state variable: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relativeName</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">executeActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;_copy_values_to_solver_ = true;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;eUserDefinedAction&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;C code cannot be generated for UserDefined actions - the model will not work as expected!!&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Unknown action type&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generateRuntimeInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runtimeInformation</span><span class="p">):</span>
        <span class="n">Ntotal</span>             <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;TotalNumberOfVariables&#39;</span><span class="p">]</span>
        <span class="n">Neq</span>                <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;NumberOfEquations&#39;</span><span class="p">]</span>
        <span class="n">IDs</span>                <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;IDs&#39;</span><span class="p">]</span>
        <span class="n">initValues</span>         <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;InitialValues&#39;</span><span class="p">]</span>
        <span class="n">initDerivatives</span>    <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;InitialDerivatives&#39;</span><span class="p">]</span>
        <span class="n">indexMappings</span>      <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;IndexMappings&#39;</span><span class="p">]</span>
        <span class="n">absoluteTolerances</span> <span class="o">=</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;AbsoluteTolerances&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span> <span class="o">=</span> <span class="n">Neq</span> <span class="o">*</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        
        <span class="n">Nvars</span> <span class="o">=</span> <span class="s">&#39;#define _Ntotal_vars_ {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ntotal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Nvars</span><span class="p">)</span>

        <span class="n">Neqns</span> <span class="o">=</span> <span class="s">&#39;#define _Neqns_ {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Neq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Neqns</span><span class="p">)</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="s">&#39;const real_t _start_time_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startTime</span><span class="p">)</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="s">&#39;const real_t _end_time_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;TimeHorizon&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">endTime</span><span class="p">)</span>

        <span class="n">reportingInterval</span> <span class="o">=</span> <span class="s">&#39;const real_t _reporting_interval_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;ReportingInterval&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reportingInterval</span><span class="p">)</span>

        <span class="n">relTolerance</span> <span class="o">=</span> <span class="s">&#39;const real_t _relative_tolerance_ = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;RelativeTolerance&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relTolerance</span><span class="p">)</span>

        <span class="n">blockIDs</span>             <span class="o">=</span> <span class="n">Neq</span> <span class="o">*</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">blockInitValues</span>      <span class="o">=</span> <span class="n">Neq</span> <span class="o">*</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">absTolerances</span>        <span class="o">=</span> <span class="n">Neq</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1E-5</span><span class="p">]</span>
        <span class="n">blockInitDerivatives</span> <span class="o">=</span> <span class="n">Neq</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">oi</span><span class="p">,</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">indexMappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">IDs</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">blockIDs</span><span class="p">[</span><span class="n">bi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="k">elif</span> <span class="n">IDs</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
               <span class="n">blockIDs</span><span class="p">[</span><span class="n">bi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">IDs</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">blockInitValues</span><span class="p">[</span><span class="n">bi</span><span class="p">]</span>      <span class="o">=</span> <span class="n">initValues</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span>
                <span class="n">blockInitDerivatives</span><span class="p">[</span><span class="n">bi</span><span class="p">]</span> <span class="o">=</span> <span class="n">initDerivatives</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span>
                <span class="n">absTolerances</span><span class="p">[</span><span class="n">bi</span><span class="p">]</span>        <span class="o">=</span> <span class="n">absoluteTolerances</span><span class="p">[</span><span class="n">oi</span><span class="p">]</span>

        <span class="n">strIDs</span> <span class="o">=</span> <span class="s">&#39;const int _IDs_[_Neqns_] = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">blockIDs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strIDs</span><span class="p">)</span>
            
        <span class="n">strInitValues</span> <span class="o">=</span> <span class="s">&#39;const real_t _initValues_[_Neqns_] = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">blockInitValues</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strInitValues</span><span class="p">)</span>

        <span class="n">strInitDerivs</span> <span class="o">=</span> <span class="s">&#39;const real_t _initDerivatives_[_Neqns_] = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">blockInitDerivatives</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strInitDerivs</span><span class="p">)</span>

        <span class="n">strAbsTol</span> <span class="o">=</span> <span class="s">&#39;const real_t _absolute_tolerances_[_Neqns_] = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">absTolerances</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strAbsTol</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;Domains&#39;</span><span class="p">]:</span>
            <span class="n">relativeName</span>   <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">domain</span><span class="p">[</span><span class="s">&#39;CanonicalName&#39;</span><span class="p">])</span>
            <span class="n">formattedName</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
            <span class="n">name</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">formattedName</span><span class="p">)</span>
            <span class="n">description</span>    <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="s">&#39;Description&#39;</span><span class="p">]</span>
            <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="s">&#39;NumberOfPoints&#39;</span><span class="p">]</span>
            <span class="n">domains</span>        <span class="o">=</span> <span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s">&#39;NumberOfPoints&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
            <span class="n">points</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s">&#39;Points&#39;</span><span class="p">])</span> <span class="c"># Numpy array</span>

            <span class="n">domTemplate</span>   <span class="o">=</span> <span class="s">&#39;int {name}_np; /* Number of points in domain {name} */&#39;</span>
            <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;real_t {name}{domains}; /* {description} */ </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                            <span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span><span class="p">,</span>
                                                            <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

            <span class="n">domTemplate</span>   <span class="o">=</span> <span class="s">&#39;const int {name}_np = {numberOfPoints};&#39;</span>
            <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;real_t {name}{domains} = {points};&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                           <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">numberOfPoints</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                            <span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span><span class="p">,</span>
                                                            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">,</span>
                                                            <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

            <span class="n">domTemplate</span>   <span class="o">=</span> <span class="s">&#39;_m_-&gt;{name}_np = {name}_np;&#39;</span>
            <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;memcpy(&amp;_m_-&gt;{name}, &amp;{name}, {numberOfPoints} * sizeof(real_t));</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                             <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">numberOfPoints</span><span class="p">))</span>

            <span class="n">struct_name</span> <span class="o">=</span> <span class="n">formattedName</span> <span class="o">+</span> <span class="s">&#39;_np&#39;</span>
            <span class="n">flat_name</span>   <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_np&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;NumberOfPointsInDomain&#39;</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s">&#39;Points&#39;</span><span class="p">])):</span>
                <span class="n">struct_name</span> <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formattedName</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">flat_name</span>   <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;DomainPoints&#39;</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
            
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;Parameters&#39;</span><span class="p">]:</span>
            <span class="n">relativeName</span>    <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">[</span><span class="s">&#39;CanonicalName&#39;</span><span class="p">])</span>
            <span class="n">formattedName</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
            <span class="n">name</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">formattedName</span><span class="p">)</span>
            <span class="n">description</span>     <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="s">&#39;Description&#39;</span><span class="p">]</span>
            <span class="n">numberOfPoints</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="s">&#39;NumberOfPoints&#39;</span><span class="p">])</span>
            <span class="n">values</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="s">&#39;Values&#39;</span><span class="p">])</span> <span class="c"># Numpy array</span>
            <span class="n">numberOfDomains</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="s">&#39;Domains&#39;</span><span class="p">])</span>
            <span class="n">domains</span>         <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">numberOfDomains</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">domains</span> <span class="o">=</span> <span class="s">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="p">)</span> <span class="k">for</span> <span class="n">np</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">[</span><span class="s">&#39;Domains&#39;</span><span class="p">]))</span>

                <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;real_t {name}{domains}; /* {description} */ </span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                                <span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span><span class="p">,</span>
                                                                <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

                <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;real_t {name}{domains} = {values};&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                                <span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span><span class="p">,</span>
                                                                <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">))</span>

                <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;memcpy(&amp;_m_-&gt;{name}, &amp;{name}, {numberOfPoints} * sizeof(real_t));</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                                <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">numberOfPoints</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;real_t {name}; /* {description} */ </span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parametersDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                                <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">))</span>

                <span class="n">paramTemplate</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;{name} = {value};</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parametersInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                                                                 <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="n">numberOfDomains</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">struct_name</span> <span class="o">=</span> <span class="n">formattedName</span>
                <span class="n">flat_name</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">struct_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;Parameter&#39;</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">domainsIndexesMap</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="s">&#39;DomainsIndexesMap&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numberOfPoints</span><span class="p">):</span>
                    <span class="n">domIndexes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">domainsIndexesMap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c"># list of integers</span>
                    <span class="n">struct_name</span> <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formattedName</span><span class="p">,</span>  <span class="s">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">domIndexes</span><span class="p">))</span>
                    <span class="n">flat_name</span>   <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>           <span class="s">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">domIndexes</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;Parameter&#39;</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="p">)</span>

                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                it = numpy.nditer(parameter[&#39;Values&#39;], flags=[&#39;c_index&#39;, &#39;multi_index&#39;])</span>
<span class="sd">                while not it.finished:</span>
<span class="sd">                    #print name + &quot;%s = %d&quot; % (it.multi_index, it[0])</span>
<span class="sd">                    p_name = &#39;{0}[{1}]&#39;.format(name,  &#39;][&#39;.join(str(index) for index in it.multi_index))</span>
<span class="sd">                    self.floatValuesReferences.append( (&#39;Parameter&#39;, p_name, value_ref) )</span>
<span class="sd">                    print p_name</span>
<span class="sd">                    value_ref += 1</span>
<span class="sd">                    it.iternext()</span>
<span class="sd">                &quot;&quot;&quot;</span>
                
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;Variables&#39;</span><span class="p">]:</span>
            <span class="n">relativeName</span>   <span class="o">=</span> <span class="n">daeGetRelativeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapperInstanceName</span><span class="p">,</span> <span class="n">variable</span><span class="p">[</span><span class="s">&#39;CanonicalName&#39;</span><span class="p">])</span>
            <span class="n">formattedName</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatIdentifier</span><span class="p">(</span><span class="n">relativeName</span><span class="p">)</span>
            <span class="n">name</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">formattedName</span><span class="p">)</span>
            <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">variable</span><span class="p">[</span><span class="s">&#39;NumberOfPoints&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">numberOfPoints</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ID</span>           <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="s">&#39;IDs&#39;</span><span class="p">])</span>        <span class="c"># cnDifferential, cnAssigned or cnAlgebraic</span>
                <span class="n">value</span>        <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="s">&#39;Values&#39;</span><span class="p">])</span>   <span class="c"># numpy float</span>
                <span class="n">overallIndex</span> <span class="o">=</span> <span class="n">variable</span><span class="p">[</span><span class="s">&#39;OverallIndex&#39;</span><span class="p">]</span>
                <span class="n">fullName</span>     <span class="o">=</span> <span class="n">relativeName</span>

                <span class="n">blockIndex</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">ID</span> <span class="o">!=</span> <span class="n">cnAssigned</span><span class="p">:</span>
                    <span class="n">blockIndex</span> <span class="o">=</span> <span class="n">indexMappings</span><span class="p">[</span><span class="n">overallIndex</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexBase</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span><span class="p">[</span><span class="n">blockIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullName</span>

                <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnDifferential</span><span class="p">:</span>
                    <span class="n">name_</span> <span class="o">=</span> <span class="s">&#39;values[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockIndex</span><span class="p">)</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;{name} = {value}; /* {fullName} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">fullName</span> <span class="o">=</span> <span class="n">fullName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">initialConditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnAssigned</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;real_t {name}; /* {fullName} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">fullName</span> <span class="o">=</span> <span class="n">fullName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;_m_-&gt;{name} = {value};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnAssigned</span><span class="p">:</span>
                    <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Assigned&#39;</span>
                <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnDifferential</span><span class="p">:</span>
                    <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Differential&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Algebraic&#39;</span>

                <span class="n">struct_name</span> <span class="o">=</span> <span class="n">formattedName</span>
                <span class="n">flat_name</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">struct_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">ref_type</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="n">blockIndex</span><span class="p">)</span> <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">domainsIndexesMap</span> <span class="o">=</span> <span class="n">variable</span><span class="p">[</span><span class="s">&#39;DomainsIndexesMap&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numberOfPoints</span><span class="p">):</span>
                    <span class="n">domIndexes</span>   <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">domainsIndexesMap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>              <span class="c"># list of integers</span>
                    <span class="n">ID</span>           <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="s">&#39;IDs&#39;</span><span class="p">][</span><span class="n">domIndexes</span><span class="p">])</span>         <span class="c"># cnDifferential, cnAssigned or cnAlgebraic</span>
                    <span class="n">value</span>        <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="s">&#39;Values&#39;</span><span class="p">][</span><span class="n">domIndexes</span><span class="p">])</span>    <span class="c"># numpy float</span>
                    <span class="n">overallIndex</span> <span class="o">=</span> <span class="n">variable</span><span class="p">[</span><span class="s">&#39;OverallIndex&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">fullName</span>     <span class="o">=</span> <span class="n">relativeName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">domIndexes</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

                    <span class="n">blockIndex</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">if</span> <span class="n">ID</span> <span class="o">!=</span> <span class="n">cnAssigned</span><span class="p">:</span>
                        <span class="n">blockIndex</span> <span class="o">=</span> <span class="n">indexMappings</span><span class="p">[</span><span class="n">overallIndex</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">indexBase</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span><span class="p">[</span><span class="n">blockIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullName</span>

                    <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnDifferential</span><span class="p">:</span>
                        <span class="n">name_</span> <span class="o">=</span> <span class="s">&#39;values[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockIndex</span><span class="p">)</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;{name} = {value}; /* {fullName} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">fullName</span> <span class="o">=</span> <span class="n">fullName</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initialConditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnAssigned</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    
                        <span class="n">name_</span> <span class="o">=</span> <span class="n">formattedName</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">domIndexes</span><span class="p">)</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;real_t {name}; /* {fullName} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">fullName</span> <span class="o">=</span> <span class="n">fullName</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesDefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                        <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;{name} = {value};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assignedVariablesInits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnAssigned</span><span class="p">:</span>
                        <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Assigned&#39;</span>
                    <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">cnDifferential</span><span class="p">:</span>
                        <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Differential&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ref_type</span> <span class="o">=</span> <span class="s">&#39;Algebraic&#39;</span>

                    <span class="n">struct_name</span> <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formattedName</span><span class="p">,</span>  <span class="s">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">domIndexes</span><span class="p">))</span>
                    <span class="n">flat_name</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">flattenIdentifier</span><span class="p">(</span><span class="n">struct_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">ref_type</span><span class="p">,</span> <span class="n">struct_name</span><span class="p">,</span> <span class="n">flat_name</span><span class="p">,</span> <span class="n">blockIndex</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">varNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">name_</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span> <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableNames</span><span class="p">]</span>
        <span class="n">strVariableNames</span> <span class="o">=</span> <span class="s">&#39;const char* _variable_names_[_Neqns_] = {0};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exprFormatter</span><span class="o">.</span><span class="n">formatNumpyArray</span><span class="p">(</span><span class="n">varNames</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strVariableNames</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">pprint</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">floatValuesReferences</span><span class="p">)</span>

        <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">s_indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultIndent</span>

        <span class="c"># First generate residuals for equations and port connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;residuals&#39;</span>
        <span class="k">for</span> <span class="n">port_connection</span> <span class="ow">in</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;PortConnections&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* Port connection: {0} -&gt; {1} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;PortFrom&#39;</span><span class="p">],</span> <span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;PortTo&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* Equations */&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="p">)</span>

        <span class="c"># Then generate jacobians for equations and port connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equationGenerationMode</span>  <span class="o">=</span> <span class="s">&#39;jacobian&#39;</span>
        <span class="k">for</span> <span class="n">port_connection</span> <span class="ow">in</span> <span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;PortConnections&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* Port connection: {0} -&gt; {1} */&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;PortFrom&#39;</span><span class="p">],</span> <span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;PortTo&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">port_connection</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_indent</span> <span class="o">+</span> <span class="s">&#39;/* Equations */&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processEquations</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;Equations&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="p">)</span>

        <span class="c"># Finally generate together residuals and jacobians for STNs</span>
        <span class="c"># _processSTNs will take care of self.equationGenerationMode regime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processSTNs</span><span class="p">(</span><span class="n">runtimeInformation</span><span class="p">[</span><span class="s">&#39;STNs&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="p">)</span>

   </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/[d][a][e]_Tools_project.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">DAE Tools Project 1.3.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2013, Dragan Nikolic.
      Last updated on May 24, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>